<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Shia Islamic Adventure Quest</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&amp;family=Fredoka:wght@400;500&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
<script defer="" type="module">
        // Import Firebase libraries
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBD2asTEG40b4hhVmUZKlGd3ZPe-NJctxM",
            authDomain: "shia-kids-learning-tool.firebaseapp.com",
            projectId: "shia-kids-learning-tool",
            storageBucket: "shia-kids-learning-tool.appspot.com",
            messagingSenderId: "786313108719",
            appId: "1:786313108719:web:5d4d9ced7abd14b9d18f1a"
        };

        // Initialize Firebase
        const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
        if (!app) {
            console.error('Firebase initialization failed');
            alert('Failed to connect to the app. Please try again later.');
        }
        const auth = getAuth(app);

        // Global variables
        let userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, quiz: {}, artwork: {}, storyPath: [] };
        let isAdmin = false;

        // Quiz questions stored in localStorage
        let quizQuestions = JSON.parse(localStorage.getItem('quizQuestions')) || {
            'Level-1': [
                { id: 'q1', type: 'text', question: 'What is the name of the creator of the universe?', answer: 'Allah' },
                { id: 'q2', type: 'text', question: 'What is the name of the book that was revealed to Prophet Muhammad(s)?', answer: 'Quran' },
                { id: 'q3', type: 'multiple', question: 'Which Prophet was stuck in the belly of the whale?', options: ['Yusuf', 'Yunus', 'Ibrahim'], answer: 'Yunus' }
            ],
            'Level-2': [], 'Level-3': [], 'Level-4': [], 'Level-5': [], 'Level-6': [], 'Level-7': []
        };

        function saveQuizQuestions() {
            localStorage.setItem('quizQuestions', JSON.stringify(quizQuestions));
        }

        // Define functions globally within the module
        window.showLoginModal = function() {
            console.log('Attempting to show login modal...');
            const modal = document.getElementById('login-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Login modal displayed');
            } else {
                console.error('Login modal element not found');
            }
        };

        window.showSignupModal = function() {
            console.log('Attempting to show signup modal...');
            const modal = document.getElementById('signup-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Signup modal displayed');
            } else {
                console.error('Signup modal element not found');
            }
        };

        window.showAdminLoginModal = function() {
            console.log('Attempting to show admin login modal...');
            const modal = document.getElementById('admin-login-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Admin login modal displayed');
            } else {
                console.error('Admin login modal element not found');
            }
        };

        window.showSection = function(sectionId) {
            document.querySelectorAll('.section, #landing-page, #hero').forEach(el => el.classList.add('hidden'));
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                gsap.from(`#${sectionId.replace(/ /g, '-')}`, { opacity: 1, y: 50, duration: 0.5, ease: 'power2.out' });
                if (sectionId === 'missions') showMissions();
                if (sectionId === 'profile' && userData.email) showProfile();
                if (sectionId === 'matching-game') initMatchingGame();
                if (sectionId === 'quiz') showQuiz();
                if (sectionId === 'admin-quiz') showAdminQuiz();
                updateProgress();
                updateBadges();
            }
        };

        window.signupUser = function() {
            userData.name = document.getElementById('signup-name').value || 'Young Explorer';
            userData.gender = document.querySelector('input[name="gender"]:checked').value;
            userData.year = document.getElementById('year-select').value;
            const selected = document.querySelector('.character.selected');
            userData.character = selected ? selected.src : document.querySelector('.character').src;
            saveUserData();

            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    alert("‚úÖ Sign-up successful!");
                    userData.email = email;
                    isAdmin = email === 'melzein1987@gmail.com';
                    closeModal({ target: { className: 'modal' } });
                    loadUserData();
                    showSection('welcome');
                })
                .catch(error => alert("‚ùå " + error.message));
        };

        window.login = function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    alert("‚úÖ Login successful!");
                    userData.email = email;
                    isAdmin = email === 'melzein1987@gmail.com';
                    loadUserData();
                })
                .catch(error => alert("‚ùå " + error.message));
        };

        window.resetPassword = function() {
            const email = document.getElementById('reset-email').value;
            sendPasswordResetEmail(auth, email)
                .then(() => alert("üìß Password reset email sent!"))
                .catch(error => alert("‚ùå " + error.message));
        };

        window.logout = function() {
            signOut(auth).then(() => {
                alert("‚úÖ Logged out successfully!");
                userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, quiz: {}, artwork: {}, storyPath: [] };
                isAdmin = false;
                localStorage.removeItem('userData');
                document.getElementById('landing-page').classList.add('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
                document.getElementById('avatar-display').style.display = 'none';
                document.getElementById('star-count').textContent = '0 ‚≠ê';
                ['missions', 'matching-game', 'quiz', 'admin-quiz'].forEach(id => {
                    const section = document.getElementById(id);
                    if (section) section.classList.add('hidden');
                });
                document.getElementById('hero').classList.remove('hidden');
            }).catch(error => alert("‚ùå " + error.message));
        };

        function loadUserData() {
            const saved = localStorage.getItem('userData');
            if (saved) {
                userData = JSON.parse(saved);
                if (!userData.badges) userData.badges = ['Explorer'];
                if (!userData.quiz) userData.quiz = {};
                document.getElementById('avatar-display').src = userData.character || 'https://yourusername.github.io/your-repo/images/mascot.png';
                document.getElementById('avatar-display').style.display = 'block';
                document.getElementById('welcome-name').textContent = userData.name || 'Young Explorer';
                updateStarCounter();
                updateProgress();
                updateBadges();
                document.getElementById('landing-page').classList.add('hidden');
                document.getElementById('welcome').classList.remove('hidden');
                showSection('welcome');
            } else {
                document.getElementById('hero').classList.remove('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
            }
        }

        function saveUserData() {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        document.querySelectorAll('.character').forEach(img => {
            img.addEventListener('click', () => {
                document.querySelectorAll('.character').forEach(i => i.classList.remove('selected'));
                img.classList.add('selected');
                userData.character = img.src;
                document.getElementById('avatar-display').src = userData.character;
                saveUserData();
            });
        });

        window.closeModal = function(event) {
            if (event.target.classList.contains('modal') || event.target.classList.contains('btn')) {
                const modalId = event.target.closest('.modal')?.id;
                if (modalId) document.getElementById(modalId).style.display = 'none';
                document.getElementById('hero').classList.remove('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
                console.log('Modal closed via backdrop or button');
            }
        };

        window.loginAdmin = function() {
            const email = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const adminEmail = 'melzein1987@gmail.com';
            const adminPassword = 'admin123';
            if (email === adminEmail && password === adminPassword) {
                alert('Admin login successful!');
                isAdmin = true;
                userData.email = email;
                closeModal({ target: { className: 'modal' } });
                loadUserData();
                showSection('welcome');
            } else {
                alert('Invalid admin credentials!');
            }
        };

        function showMissions() {
            const container = document.getElementById('missions');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Mission Board ‚≠ê</h2>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Daily Salah</h3>
                    <p>How many daily prayers?</p>
                    <input id="mission-salah-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                    <button class="btn mt-2" onclick="checkMission('salah', '5')">Submit üéâ</button>
                </div>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Learn Dua</h3>
                    <p>Dua before eating?</p>
                    <input id="mission-dua-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                    <button class="btn mt-2" onclick="checkMission('dua', 'Bismillah')">Submit üéâ</button>
                </div>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>`;
            container.appendChild(content);
        }

        function checkMission(id, answer) {
            const userAnswer = document.getElementById(`mission-${id}-input`).value.toLowerCase();
            if (userAnswer === answer.toLowerCase()) {
                userData.stars += 2;
                userData.progress = Math.min(userData.progress + 1, 10);
                userData.missions[id] = true;
                updateStarCounter();
                updateProgress();
                confetti();
                const feedback = document.createElement('p');
                feedback.className = 'text-green-600 mt-2';
                feedback.textContent = 'Mission Complete! +2 Stars! üéâ';
                document.getElementById(`mission-${id}-input`).parentElement.appendChild(feedback);
            } else {
                const feedback = document.createElement('p');
                feedback.className = 'text-red-600 mt-2';
                feedback.textContent = 'Wrong! Try again! üòï';
                document.getElementById(`mission-${id}-input`).parentElement.appendChild(feedback);
            }
        }

        function showProfile() {
            if (!userData.email) {
                alert("Please log in to view your profile!");
                showSection('welcome');
                return;
            }
            const container = document.getElementById('profile');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Profile üè°</h2>
                <p>Email: ${userData.email || 'Not set'}</p>
                <p>Name: ${userData.name}</p>
                <p>Level: ${userData.year}</p>
                <p>Stars: <span id="profile-star-count">${userData.stars}</span> ‚≠ê</p>
                <p>Progress: <span id="profile-progress">${userData.progress}/10</span></p>
                <p>Badges: ${userData.badges.join(', ')}</p>
                <img src="${userData.character || 'https://yourusername.github.io/your-repo/images/mascot.png'}" alt="Avatar" class="w-32 h-32 rounded-full mx-auto mt-4">
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>`;
            container.appendChild(content);
            updateStarCounter();
            updateProgress();
        }

        function updateStarCounter() {
            document.getElementById('star-count').textContent = `${userData.stars} ‚≠ê`;
            if (document.getElementById('profile-star-count')) document.getElementById('profile-star-count').textContent = userData.stars;
            saveUserData();
        }

        function updateProgress() {
            const progressElement = document.getElementById('progress');
            if (progressElement) {
                const progress = (userData.progress / 10) * 100;
                progressElement.style.width = `${progress}%`;
            }
            if (document.getElementById('profile-progress')) document.getElementById('profile-progress').textContent = `${userData.progress}/10`;
            saveUserData();
        }

        function updateBadges() {
            const badgeElement = document.querySelector('.badge');
            if (badgeElement) badgeElement.textContent = `üèÖ Badge: ${userData.badges[userData.badges.length - 1] || 'Explorer'}`;
            saveUserData();
        }

        function confetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Matching Game Logic
        const individuals = [
            'Prophet Muhammad(s)', 'Imam Ali(as)', 'Sayeda Fatimah Al Zahraa(as)', 'Imam Al Hasan(as)',
            'Imam Al Hussain(as)', 'Imam Al Sajjad(as)', 'Imam Al Baqir(as)', 'Imam Al Sadiq(as)',
            'Imam Al Kathim(as)', 'Imam Al Redha(as)', 'Imam Al Jawad(as)', 'Imam Al Hadi(as)',
            'Imam Al Askari(as)', 'Imam Al Mahdi(as)'
        ];

        let flippedCards = [];
        let matchedPairs = 0;
        let canFlip = true;

        function initMatchingGame() {
            const container = document.getElementById('matching-game');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `
                <h2 class="text-3xl text-orange-600 mb-4">Matching Game üß†</h2>
                <p>Match the names of the holy individuals!</p>
                <div id="game-grid" class="game-grid"></div>
                <p id="game-feedback" class="mt-4"></p>
                <button class="btn mt-4" onclick="resetMatchingGame()">Reset Game üîÑ</button>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>
            `;
            container.appendChild(content);

            const gameGrid = document.getElementById('game-grid');
            const cards = [...individuals, ...individuals]; // Duplicate for pairs
            cards.sort(() => Math.random() - 0.5); // Shuffle

            gameGrid.innerHTML = '';
            cards.forEach((name, index) => {
                const card = document.createElement('div');
                card.className = 'game-card';
                card.dataset.name = name;
                card.innerHTML = `
                    <div class="card-front">?</div>
                    <div class="card-back">${name}</div>
                `;
                card.addEventListener('click', () => flipCard(card));
                gameGrid.appendChild(card);
            });

            flippedCards = [];
            matchedPairs = 0;
            canFlip = true;
            document.getElementById('game-feedback').textContent = '';
            console.log('Matching game initialized');
        }

        function flipCard(card) {
            if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) {
                console.log('Card flip blocked: canFlip=', canFlip, 'flipped=', card.classList.contains('flipped'), 'matched=', card.classList.contains('matched'));
                return;
            }

            console.log('Flipping card:', card.dataset.name);
            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                canFlip = false;
                const [card1, card2] = flippedCards;
                console.log('Comparing:', card1.dataset.name, 'and', card2.dataset.name);

                if (card1.dataset.name === card2.dataset.name) {
                    console.log('Match found!');
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedPairs++;
                    document.getElementById('game-feedback').textContent = 'Match found! Keep going!';
                    if (matchedPairs === individuals.length) {
                        userData.stars += 14;
                        userData.progress = Math.min(userData.progress + 1, 10);
                        updateStarCounter();
                        updateProgress();
                        confetti();
                        document.getElementById('game-feedback').innerHTML = '<span class="text-green-600 text-xl">Congratulations! All pairs matched! +14 Stars! üéâ</span>';
                        console.log('Game completed! Stars awarded:', userData.stars);
                    }
                    flippedCards = [];
                    canFlip = true;
                    console.log('Flipping enabled after match, matchedPairs:', matchedPairs);
                } else {
                    console.log('No match.');
                    document.getElementById('game-feedback').textContent = 'No match. Try again!';
                    setTimeout(() => {
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        flippedCards = [];
                        canFlip = true;
                        console.log('Flipping enabled after non-match');
                    }, 1000);
                }
            } else {
                console.log('Waiting for second card, flippedCards:', flippedCards.length);
            }
        }

        window.resetMatchingGame = function() {
            initMatchingGame();
            console.log('Game reset');
        };

        // Quiz Logic
        let currentQuestionIndex = 0;
        let quizCompleted = false;

        function showQuiz() {
            if (!userData.email) {
                alert("Please log in to take the quiz!");
                showSection('welcome');
                return;
            }
            const container = document.getElementById('quiz');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Quiz Time üìö</h2>
                <p>Test your knowledge for ${userData.year}!</p>
                <div id="quiz-content" class="story-card mb-4"></div>
                <p id="quiz-feedback" class="mt-4"></p>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>`;
            container.appendChild(content);

            currentQuestionIndex = 0;
            quizCompleted = userData.quiz[userData.year]?.completed || false;
            showQuizQuestion();
        }

        function showQuizQuestion() {
            const quizContent = document.getElementById('quiz-content');
            const feedback = document.getElementById('quiz-feedback');
            feedback.textContent = '';
            const questions = quizQuestions[userData.year] || [];
            
            if (quizCompleted) {
                quizContent.innerHTML = `
                    <h3 class="text-xl">Quiz Completed!</h3>
                    <p>You've already completed the quiz for ${userData.year}. Try another activity!</p>
                `;
                return;
            }

            if (currentQuestionIndex >= questions.length) {
                quizCompleted = true;
                userData.quiz[userData.year] = userData.quiz[userData.year] || {};
                userData.quiz[userData.year].completed = true;
                userData.progress = Math.min(userData.progress + 1, 10);
                updateProgress();
                saveUserData();
                confetti();
                quizContent.innerHTML = `
                    <h3 class="text-xl">Congratulations!</h3>
                    <p class="text-green-600 text-xl">You've completed the ${userData.year} quiz! üéâ</p>
                `;
                return;
            }

            const question = questions[currentQuestionIndex];
            quizContent.innerHTML = `
                <h3 class="text-xl">Question ${currentQuestionIndex + 1}</h3>
                <p>${question.question}</p>
                ${question.type === 'text' ? 
                    `<input id="quiz-answer-${question.id}" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Type your answer">` :
                    `<div class="mt-2">${question.options.map(option => `
                        <label class="block"><input type="radio" name="quiz-${question.id}" value="${option}" class="mr-2">${option}</label>
                    `).join('')}</div>`}
                <button class="btn mt-2" onclick="checkQuizAnswer('${question.id}', '${question.answer}')">Submit üéâ</button>
            `;
        }

        window.checkQuizAnswer = function(id, correctAnswer) {
            const question = quizQuestions[userData.year][currentQuestionIndex];
            let userAnswer;
            if (question.type === 'text') {
                userAnswer = document.getElementById(`quiz-answer-${id}`).value.trim().toLowerCase();
            } else {
                const selected = document.querySelector(`input[name="quiz-${id}"]:checked`);
                userAnswer = selected ? selected.value.toLowerCase() : '';
            }

            const feedback = document.getElementById('quiz-feedback');
            if (userAnswer === correctAnswer.toLowerCase()) {
                if (!userData.quiz[userData.year]?.[id]) {
                    userData.stars += 2;
                    userData.quiz[userData.year] = userData.quiz[userData.year] || {};
                    userData.quiz[userData.year][id] = true;
                    updateStarCounter();
                    saveUserData();
                }
                feedback.className = 'text-green-600 mt-2';
                feedback.textContent = 'Correct! +2 Stars! üéâ';
                setTimeout(() => {
                    currentQuestionIndex++;
                    showQuizQuestion();
                }, 1000);
            } else {
                feedback.className = 'text-red-600 mt-2';
                feedback.textContent = 'Wrong! Try again! üòï';
            }
        };

        // Admin Quiz Management
        function showAdminQuiz() {
            if (!isAdmin) {
                alert("Access denied. Admin login required!");
                showSection('welcome');
                return;
            }
            const container = document.getElementById('admin-quiz');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `
                <h2 class="text-3xl text-orange-600 mb-4">Admin Quiz Management üîß</h2>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Add New Question</h3>
                    <input id="admin-question-text" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Question text">
                    <select id="admin-question-level" class="border rounded-lg p-2 bg-white text-black mt-2 w-full">
                        ${['Level-1', 'Level-2', 'Level-3', 'Level-4', 'Level-5', 'Level-6', 'Level-7'].map(level => `<option value="${level}">${level}</option>`).join('')}
                    </select>
                    <select id="admin-question-type" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" onchange="toggleAnswerFields()">
                        <option value="text">Free Text</option>
                        <option value="multiple">Multiple Choice</option>
                    </select>
                    <div id="answer-fields">
                        <input id="admin-answer-text" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Correct answer">
                    </div>
                    <div id="multiple-choice-fields" class="hidden">
                        <input id="admin-option-1" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Option 1">
                        <input id="admin-option-2" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Option 2">
                        <input id="admin-option-3" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Option 3">
                        <input id="admin-option-4" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Option 4">
                    </div>
                    <button class="btn mt-2" onclick="addQuestion()">Add Question ‚ûï</button>
                </div>
                <div id="question-list" class="story-card mb-4">
                    <h3 class="text-xl">Existing Questions</h3>
                    <div id="questions-display"></div>
                </div>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>
            `;
            container.appendChild(content);
            toggleAnswerFields();
            displayQuestions();
        }

        window.toggleAnswerFields = function() {
            const type = document.getElementById('admin-question-type').value;
            document.getElementById('answer-fields').classList.toggle('hidden', type === 'multiple');
            document.getElementById('multiple-choice-fields').classList.toggle('hidden', type === 'text');
        };

        window.addQuestion = function() {
            const questionText = document.getElementById('admin-question-text').value.trim();
            const level = document.getElementById('admin-question-level').value;
            const type = document.getElementById('admin-question-type').value;
            const answer = document.getElementById('admin-answer-text').value.trim();
            const options = type === 'multiple' ? [
                document.getElementById('admin-option-1').value.trim(),
                document.getElementById('admin-option-2').value.trim(),
                document.getElementById('admin-option-3').value.trim(),
                document.getElementById('admin-option-4').value.trim()
            ].filter(opt => opt) : [];

            if (!questionText || !answer || (type === 'multiple' && options.length < 2)) {
                alert('Please fill in all required fields (question, answer, and at least 2 options for multiple choice).');
                return;
            }

            if (type === 'multiple' && !options.includes(answer)) {
                alert('The correct answer must be one of the multiple-choice options.');
                return;
            }

            const id = `q${Date.now()}`; // Unique ID based on timestamp
            quizQuestions[level] = quizQuestions[level] || [];
            quizQuestions[level].push({
                id,
                type,
                question: questionText,
                answer,
                ...(type === 'multiple' && { options })
            });

            saveQuizQuestions();
            displayQuestions();
            alert('Question added successfully!');
            document.getElementById('admin-question-text').value = '';
            document.getElementById('admin-answer-text').value = '';
            if (type === 'multiple') {
                document.getElementById('admin-option-1').value = '';
                document.getElementById('admin-option-2').value = '';
                document.getElementById('admin-option-3').value = '';
                document.getElementById('admin-option-4').value = '';
            }
        };

        window.removeQuestion = function(level, id) {
            quizQuestions[level] = quizQuestions[level].filter(q => q.id !== id);
            // Clear user progress for this question
            Object.keys(userData.quiz).forEach(lvl => {
                if (userData.quiz[lvl]?.[id]) {
                    delete userData.quiz[lvl][id];
                    if (Object.keys(userData.quiz[lvl]).length === 1 && userData.quiz[lvl].completed) {
                        delete userData.quiz[lvl].completed;
                    }
                }
            });
            saveQuizQuestions();
            saveUserData();
            displayQuestions();
            alert('Question removed successfully!');
        };

        function displayQuestions() {
            const display = document.getElementById('questions-display');
            display.innerHTML = '';
            Object.keys(quizQuestions).forEach(level => {
                if (quizQuestions[level].length > 0) {
                    const levelDiv = document.createElement('div');
                    levelDiv.innerHTML = `<h4 class="text-lg mt-4">${level}</h4>`;
                    quizQuestions[level].forEach(q => {
                        const qDiv = document.createElement('div');
                        qDiv.className = 'border-b py-2';
                        qDiv.innerHTML = `
                            <p><strong>Question:</strong> ${q.question}</p>
                            <p><strong>Type:</strong> ${q.type === 'text' ? 'Free Text' : 'Multiple Choice'}</p>
                            <p><strong>Answer:</strong> ${q.answer}</p>
                            ${q.options ? `<p><strong>Options:</strong> ${q.options.join(', ')}</p>` : ''}
                            <button class="btn mt-2 bg-red-500 hover:bg-red-700" onclick="removeQuestion('${level}', '${q.id}')">Remove üóëÔ∏è</button>
                        `;
                        levelDiv.appendChild(qDiv);
                    });
                    display.appendChild(levelDiv);
                }
            });
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded, initializing app...');

            // Ensure initial UI state
            const hero = document.getElementById('hero');
            const welcomeSection = document.getElementById('welcome');
            const profileSection = document.getElementById('profile');
            const matchingGameSection = document.getElementById('matching-game');
            const quizSection = document.getElementById('quiz');
            const adminQuizSection = document.getElementById('admin-quiz');
            if (hero) hero.classList.remove('hidden');
            if (welcomeSection) welcomeSection.classList.add('hidden');
            if (profileSection) profileSection.classList.add('hidden');
            if (matchingGameSection) matchingGameSection.classList.add('hidden');
            if (quizSection) quizSection.classList.add('hidden');
            if (adminQuizSection) adminQuizSection.classList.add('hidden');

            // Initialize modals
            ['login-modal', 'signup-modal', 'admin-login-modal', 'reset-password-modal'].forEach(id => {
                const modal = document.getElementById(id);
                if (modal) modal.style.display = 'none';
            });

            // Authentication state listener
            let authInitialized = false;
            const initAuth = () => {
                if (authInitialized) return;
                authInitialized = true;

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userData.email = user.email;
                        isAdmin = user.email === 'melzein1987@gmail.com';
                        loadUserData();
                        document.getElementById('login-modal').style.display = 'none';
                        document.getElementById('hero').classList.add('hidden');
                        document.getElementById('welcome').classList.remove('hidden');
                        showSection('welcome');
                    } else {
                        userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, quiz: {}, artwork: {}, storyPath: [] };
                        isAdmin = false;
                        localStorage.removeItem('userData');
                        if (hero) hero.classList.remove('hidden');
                        if (welcomeSection) welcomeSection.classList.add('hidden');
                        if (profileSection) profileSection.classList.add('hidden');
                        if (matchingGameSection) matchingGameSection.classList.add('hidden');
                        if (quizSection) quizSection.classList.add('hidden');
                        if (adminQuizSection) adminQuizSection.classList.add('hidden');
                        ['login-modal', 'signup-modal', 'admin-login-modal', 'reset-password-modal'].forEach(id => {
                            const modal = document.getElementById(id);
                            if (modal) modal.style.display = 'none';
                        });
                    }
                }, (error) => {
                    console.error('Auth error:', error.message);
                    alert('Authentication failed. Please try again or contact support.');
                    if (hero) hero.classList.remove('hidden');
                });
            };

            initAuth();

            // Verify function availability
            console.log('Functions defined:', {
                showLoginModal: typeof window.showLoginModal,
                showSignupModal: typeof window.showSignupModal
            });

            window.addEventListener('load', () => {
                console.log('Window fully loaded, verifying UI...');
                document.getElementById('hero').classList.remove('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
                document.getElementById('matching-game').classList.add('hidden');
                document.getElementById('quiz').classList.add('hidden');
                document.getElementById('admin-quiz').classList.add('hidden');
            });
        });
</script>
<style>
        body {
            font-family: 'Fredoka', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            background: none;
            overflow: hidden;
        }
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #87CEEB url('https://yourusername.github.io/your-repo/images/background.jpg') no-repeat center center fixed;
            background-size: cover;
            z-index: -1;
        }
        .ui-container {
            position: relative;
            z-index: 1;
        }
        .header-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(90deg, #FFA500, #FF4500);
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-bar h1 {
            color: #fff;
            font-size: 1.8rem;
            text-shadow: 2px 2px #000;
            animation: bounce 1s ease-out infinite;
        }
        .tree, .cloud, .star, .moon {
            position: absolute;
            animation: float 6s infinite ease-in-out;
            z-index: 1;
        }
        .tree { content: 'üå≥'; font-size: 80px; }
        .cloud { content: '‚òÅÔ∏è'; font-size: 50px; animation: float 8s infinite ease-in-out; }
        .star { content: '‚≠ê'; font-size: 30px; animation: twinkle 2s infinite alternate; }
        .moon { content: 'üåô'; font-size: 60px; animation: shine 4s infinite ease-in-out; top: 10%; left: 10%; }
        .hero {
            height: 100vh;
            position: relative;
            overflow: hidden;
            color: #fff;
            text-align: center;
            padding-top: 10rem;
            border-radius: 0 0 50px 50px;
            display: block;
            z-index: 10;
            background: none;
        }
        .hero h1 {
            font-size: 3.5rem;
            animation: bounce 1s ease-out;
        }
        .hero p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            animation: fadeIn 1.5s ease-out;
        }
        .hero .btn {
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            color: #fff;
            padding: 2rem 4rem;
            font-size: 2rem;
            border-radius: 30px;
            transition: transform 0.3s, background 0.3s;
            text-shadow: 1px 1px #000;
            z-index: 20;
        }
        .hero .btn:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #32CD32, #87CEEB);
            box-shadow: 0 0 10px #32CD32;
        }
        .section {
            min-height: 100vh;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            z-index: 10;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding-top: 80px;
            background: none;
        }
        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            color: #000;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .card-grid {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            padding: 4rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 20;
            flex-wrap: wrap;
        }
        .card {
            background: linear-gradient(135deg, #FF69B4, #FFA500);
            border-radius: 30px;
            padding: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            text-align: center;
            overflow: hidden;
            width: 250px;
            z-index: 20;
        }
        .card:hover {
            transform: translateY(-15px);
            box-shadow: 0 15px 40px rgba(50, 205, 50, 0.3);
        }
        .card h3 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px #000;
        }
        .card p {
            color: #fff;
            text-shadow: 1px 1px #000;
        }
        .card:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
            z-index: -1;
        }
        .btn {
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            color: #fff;
            padding: 1rem 2rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1.2rem;
            transition: transform 0.3s, background 0.3s;
            text-shadow: 1px 1px #000;
            z-index: 1001;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .btn:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #32CD32, #87CEEB);
            box-shadow: 0 6px 15px rgba(50, 205, 50, 0.5);
        }
        .btn:active {
            transform: scale(0.95);
        }
        .star-counter {
            position: fixed;
            top: 70px;
            right: 1rem;
            background: #fff;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            color: #FFA500;
            z-index: 50;
            animation: pulse 2s infinite;
        }
        .avatar-display {
            position: fixed;
            top: 6rem;
            left: 1rem;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid #FFA500;
            object-fit: cover;
            animation: float 3s infinite ease-in-out;
            z-index: 50;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 201;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
            z-index: 20;
        }
        #progress {
            height: 100%;
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            width: 0%;
            transition: width 0.5s ease-in-out;
            border-radius: 10px;
        }
        .badge {
            background: #FFD700;
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            margin: 0.5rem;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 20;
        }
        .story-card {
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem auto;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: left;
            z-index: 20;
        }
        .placeholder-images {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding: 10px 0;
        }
        .placeholder-image {
            width: 400px;
            height: 300px;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .game-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            max-width: 800px;
            margin: 2rem auto;
        }
        .game-card {
            width: 100px;
            height: 100px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .game-card.flipped {
            transform: rotateY(180deg);
        }
        .game-card.matched {
            background: #90EE90;
            cursor: default;
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            text-align: center;
            padding: 5px;
            border-radius: 10px;
        }
        .card-front {
            background: linear-gradient(135deg, #FFA500, #FF69B4);
            color: #fff;
            font-size: 2rem;
        }
        .card-back {
            background: #fff;
            color: #000;
            transform: rotateY(180deg);
            font-size: 0.8rem;
        }
        .hidden {
            display: none;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        @keyframes twinkle {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        @keyframes shine {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            .card {
                width: 120px;
                padding: 0.5rem;
            }
            .hero h1 {
                font-size: 2.5rem;
            }
            .hero .btn {
                padding: 1rem 2rem;
                font-size: 1.5rem;
            }
            .section {
                padding: 2rem 1rem;
            }
            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
            .placeholder-images {
                flex-direction: column;
                gap: 10px;
            }
            .placeholder-image {
                width: 100%;
                height: 200px;
            }
            .game-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }
            .game-card {
                width: 70px;
                height: 70px;
                font-size: 0.7rem;
            }
            .card-back {
                font-size: 0.6rem;
            }
        }
</style>
</head>
<body>
<div class="background-layer"></div>
<div class="ui-container">
<div class="header-bar">
<h1>Shia Islamic Adventure Quest</h1>
</div>
<div class="star-counter" id="star-count">0 ‚≠ê</div>
<img alt="Avatar" class="avatar-display" id="avatar-display" src="https://yourusername.github.io/your-repo/images/mascot.png" style="display: none;"/>
<div class="tree" style="top: 20%; left: 5%;"></div>
<div class="cloud" style="top: 10%; right: 10%;"></div>
<div class="star" style="top: 15%; left: 20%;"></div>
<div class="moon" style="top: 10%; left: 10%;"></div>
<div class="hero" id="hero">
<h1>Welcome to Your Adventure!</h1>
<p>Explore, learn, and grow with Shia Islamic teachings.</p>
<button class="btn" onclick="showLoginModal()">Login üö™</button>
<button class="btn" onclick="showSignupModal()">Sign Up ‚ú®</button>
<div class="placeholder-images">
<img alt="Madinah" class="placeholder-image" src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/madinah.jpg"/>
<img alt="Najaf" class="placeholder-image" src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/najaf.jpg"/>
</div>
</div>
<div class="hidden" id="landing-page">
<div class="card-grid">
<div class="card" onclick="showSection('missions')">
<h3>Missions</h3>
<p>Daily Tasks ‚≠ê</p>
</div>
<div class="card" onclick="showSection('profile')">
<h3>Profile</h3>
<p>Your Journey üè°</p>
</div>
<div class="card" onclick="showSection('matching-game')">
<h3>Matching Game</h3>
<p>Match Holy Individuals üß†</p>
</div>
<div class="card" onclick="showSection('quiz')">
<h3>Quiz</h3>
<p>Test Your Knowledge üìö</p>
</div>
</div>
<button class="btn mt-4" onclick="showAdminLoginModal()">Admin Login üîê</button>
</div>
<div class="section hidden" id="welcome" style="opacity: 30.00">
<div class="content">
<h2 class="text-3xl text-orange-600 mb-4">Welcome, <span id="welcome-name">Young Explorer</span>! üåü</h2>
<div class="progress-bar">
<div id="progress"></div>
</div>
<p class="badge"></p>
<div class="card-grid" id="welcome-card-grid">
<div class="card" onclick="showSection('missions')">
<h3>Missions</h3>
<p>Daily Tasks ‚≠ê</p>
</div>
<div class="card" onclick="showSection('profile')">
<h3>Profile</h3>
<p>Your Journey üè°</p>
</div>
<div class="card" onclick="showSection('matching-game')">
<h3>Matching Game</h3>
<p>Match Holy Individuals üß†</p>
</div>
<div class="card" onclick="showSection('quiz')">
<h3>Quiz</h3>
<p>Test Your Knowledge üìö</p>
</div>
</div>
<button class="btn mt-4" onclick="showAdminLoginModal()">Admin Login üîê</button>
<button class="btn mt-4" onclick="logout()">Logout üö™</button>
</div>
</div>
<div class="section hidden" id="missions">
<div class="content">
<h2 class="text-3xl text-orange-600 mb-4">Mission Board ‚≠ê</h2>
<div class="story-card mb-4">
<h3 class="text-xl">Daily Salah</h3>
<p>How many daily prayers?</p>
<input class="border rounded-lg p-2 bg-white text-black mt-2" id="mission-salah-input" placeholder="Type your answer"/>
<button class="btn mt-2" onclick="checkMission('salah', '5')">Submit üéâ</button>
</div>
<div class="story-card mb-4">
<h3 class="text-xl">Learn Dua</h3>
<p>Dua before eating?</p>
<input class="border rounded-lg p-2 bg-white text-black mt-2" id="mission-dua-input" placeholder="Type your answer"/>
<button class="btn mt-2" onclick="checkMission('dua', 'Bismillah')">Submit üéâ</button>
</div>
<button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
<button class="btn mt-2" onclick="logout()">Logout üö™</button>
</div>
</div>
<div class="section hidden" id="profile"></div>
<div class="section hidden" id="matching-game"></div>
<div class="section hidden" id="quiz"></div>
<div class="section hidden" id="admin-quiz"></div>
<div class="modal" id="login-modal">
<div class="modal-content">
<h2>Login üö™</h2>
<input class="border rounded-lg p-2 bg-white text-black mt-4 w-full" id="login-email" placeholder="Email" type="email"/>
<input class="border rounded-lg p-2 bg-white text-black mt-2 w-full" id="login-password" placeholder="Password" type="password"/>
<button class="btn mt-4" onclick="login()">Login üéâ</button>
<button class="btn mt-2" onclick="showResetPasswordModal()">Forgot Password? üîë</button>
<button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
</div>
</div>
<div class="modal" id="signup-modal">
<div class="modal-content">
<h2>Sign Up ‚ú®</h2>
<input class="border rounded-lg p-2 bg-white text-black mt-4 w-full" id="signup-name" placeholder="Name"/>
<div class="mt-2">
<label><input checked="" name="gender" type="radio" value="boy"/> Boy üë¶</label>
<label class="ml-4"><input name="gender" type="radio" value="girl"/> Girl üëß</label>
</div>
<select class="border rounded-lg p-2 bg-white text-black mt-2 w-full" id="year-select">
<option value="Level-1">Level 1</option>
<option value="Level-2">Level 2</option>
<option value="Level-3">Level 3</option>
<option value="Level-4">Level 4</option>
<option value="Level-5">Level 5</option>
<option value="Level-6">Level 6</option>
<option value="Level-7">Level 7</option>
</select>
<div class="character-select mt-2">
<img alt="Boy" class="character w-16 h-16 mr-2" src="https://yourusername.github.io/your-repo/images/mascot.png"/>
<img alt="Girl" class="character w-16 h-16" src="https://yourusername.github.io/your-repo/images/girl.png"/>
</div>
<input class="border rounded-lg p-2 bg-white text-black mt-2 w-full" id="signup-email" placeholder="Email" type="email"/>
<input class="border rounded-lg p-2 bg-white text-black mt-2 w-full" id="signup-password" placeholder="Password" type="password"/>
<button class="btn mt-4" onclick="signupUser()">Sign Up üéâ</button>
<button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
</div>
</div>
<div class="modal" id="admin-login-modal">
<div class="modal-content">
<h2>Admin Login üîê</h2>
<input class="border rounded-lg p-2 bg-white text-black mt-4 w-full" id="admin-username" placeholder="Email" type="email"/>
<input class="border rounded-lg p-2 bg-white text-black mt-2 w-full" id="admin-password" placeholder="Password" type="password"/>
<button class="btn mt-4" onclick="loginAdmin()">Login üéâ</button>
<button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
</div>
</div>
<div class="modal" id="reset-password-modal">
<div class="modal-content">
<h2>Reset Password üîë</h2>
<input class="border rounded-lg p-2 bg-white text-black mt-4 w-full" id="reset-email" placeholder="Email" type="email"/>
<button class="btn mt-4" onclick="resetPassword()">Send Reset Email üìß</button>
<button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
</div>
</div>
</div>
<script>
    // Dynamically add Admin Quiz Management card for admin user
    document.addEventListener('DOMContentLoaded', () => {
        function updateWelcomeCardGrid() {
            const cardGrid = document.getElementById('welcome-card-grid');
            if (isAdmin) {
                const adminCard = document.createElement('div');
                adminCard.className = 'card';
                adminCard.onclick = () => showSection('admin-quiz');
                adminCard.innerHTML = `
                    <h3>Admin Quiz Management</h3>
                    <p>Manage Quiz Questions üîß</p>
                `;
                if (!cardGrid.querySelector('div[onclick="showSection(\'admin-quiz\')"]')) {
                    cardGrid.appendChild(adminCard);
                }
            }
        }

        // Update card grid when user data is loaded
        const originalLoadUserData = loadUserData;
        loadUserData = function() {
            originalLoadUserData();
            updateWelcomeCardGrid();
        };

        // Update card grid on admin login
        const originalLoginAdmin = window.loginAdmin;
        window.loginAdmin = function() {
            originalLoginAdmin();
            updateWelcomeCardGrid();
        };

        // Update card grid on regular login
        const originalLogin = window.login;
        window.login = function() {
            originalLogin();
            updateWelcomeCardGrid();
        };

        // Update card grid on signup
        const originalSignupUser = window.signupUser;
        window.signupUser = function() {
            originalSignupUser();
            updateWelcomeCardGrid();
        };
    });
</script>
</body>
</html>