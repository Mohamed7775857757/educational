<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shia Islamic Adventure Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
    <script type="module" defer>
        // Import Firebase libraries
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBD2asTEG40b4hhVmUZKlGd3ZPe-NJctxM",
            authDomain: "shia-kids-learning-tool.firebaseapp.com",
            projectId: "shia-kids-learning-tool",
            storageBucket: "shia-kids-learning-tool.appspot.com",
            messagingSenderId: "786313108719",
            appId: "1:786313108719:web:5d4d9ced7abd14b9d18f1a"
        };

        // Initialize Firebase
        const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
        if (!app) {
            console.error('Firebase initialization failed');
            alert('Failed to connect to the app. Please try again later.');
            return;
        }
        const auth = getAuth(app);

        // Global variables
        let userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
        let currentQuestion = 0;
        let score = 0;
        let flippedCards = [];
        let matchedCards = [];
        let lock = false;
        const questions = {
            'Level-1': [
                { question: 'What is the name of our Creator?', type: 'text', answer: 'Allah' },
                { question: 'Who is the final Messenger?', type: 'multiple', options: ['Prophet Musa', 'Prophet Muhammad', 'Prophet Isa'], answer: 'Prophet Muhammad' }
            ],
            'Level-2': [
                { question: 'Who was the first Imam?', type: 'text', answer: 'Imam Ali' },
                { question: 'How many Imams are there?', type: 'text', answer: '12' }
            ],
            'Level-3': [
                { question: 'What is the first step of Wudhu?', type: 'text', answer: 'Niyyah' },
                { question: 'What do you wash first in Wudhu?', type: 'text', answer: 'Face' }
            ],
            'Level-4': [
                { question: 'Where did the Battle of Karbala take place?', type: 'text', answer: 'Karbala' },
                { question: 'Who was the leader at Karbala?', type: 'text', answer: 'Imam Hussain' }
            ],
            'Level-5': [
                { question: 'What is the Kaaba made of?', type: 'text', answer: 'Stone' },
                { question: 'Where is the Kaaba located?', type: 'text', answer: 'Mecca' }
            ],
            'Level-6': [
                { question: 'What is the significance of Hajj?', type: 'text', answer: 'Pilgrimage' },
                { question: 'How often is Hajj performed?', type: 'text', answer: 'Once' }
            ],
            'Level-7': [
                { question: 'What is the name of the holy book?', type: 'text', answer: 'Quran' },
                { question: 'How many chapters are in the Quran?', type: 'text', answer: '114' }
            ],
            'Level-8': [],
            'Level-9': [],
            'Level-10': []
        };
        const memoryCards = [
            { name: 'Prophet Muhammad(s)', match: 'Prophet Muhammad(s)', id: 1 },
            { name: 'Prophet Muhammad(s)', match: 'Prophet Muhammad(s)', id: 2 },
            { name: 'Imam Ali(as)', match: 'Imam Ali(as)', id: 3 },
            { name: 'Imam Ali(as)', match: 'Imam Ali(as)', id: 4 },
            { name: 'Sayeda Fatimah Al-Zahra(as)', match: 'Sayeda Fatimah Al-Zahra(as)', id: 5 },
            { name: 'Sayeda Fatimah Al-Zahra(as)', match: 'Sayeda Fatimah Al-Zahra(as)', id: 6 },
            { name: 'Imam Al Hasan(as)', match: 'Imam Al Hasan(as)', id: 7 },
            { name: 'Imam Al Hasan(as)', match: 'Imam Al Hasan(as)', id: 8 },
            { name: 'Imam Al Husayn(as)', match: 'Imam Al Husayn(as)', id: 9 },
            { name: 'Imam Al Husayn(as)', match: 'Imam Al Husayn(as)', id: 10 },
            { name: 'Imam Al Sajjad(as)', match: 'Imam Al Sajjad(as)', id: 11 },
            { name: 'Imam Al Sajjad(as)', match: 'Imam Al Sajjad(as)', id: 12 },
            { name: 'Imam Al Baqir(as)', match: 'Imam Al Baqir(as)', id: 13 },
            { name: 'Imam Al Baqir(as)', match: 'Imam Al Baqir(as)', id: 14 },
            { name: 'Imam Al Sadiq(as)', match: 'Imam Al Sadiq(as)', id: 15 },
            { name: 'Imam Al Sadiq(as)', match: 'Imam Al Sadiq(as)', id: 16 },
            { name: 'Imam Al Kadhim(as)', match: 'Imam Al Kadhim(as)', id: 17 },
            { name: 'Imam Al Kadhim(as)', match: 'Imam Al Kadhim(as)', id: 18 },
            { name: 'Imam Al Ridha(as)', match: 'Imam Al Ridha(as)', id: 19 },
            { name: 'Imam Al Ridha(as)', match: 'Imam Al Ridha(as)', id: 20 },
            { name: 'Imam Al Jawad(as)', match: 'Imam Al Jawad(as)', id: 21 },
            { name: 'Imam Al Jawad(as)', match: 'Imam Al Jawad(as)', id: 22 },
            { name: 'Imam Al Hadi(as)', match: 'Imam Al Hadi(as)', id: 23 },
            { name: 'Imam Al Hadi(as)', match: 'Imam Al Hadi(as)', id: 24 },
            { name: 'Imam Al Askari(as)', match: 'Imam Al Askari(as)', id: 25 },
            { name: 'Imam Al Askari(as)', match: 'Imam Al Askari(as)', id: 26 },
            { name: 'Imam Al Mahdi(as)', match: 'Imam Al Mahdi(as)', id: 27 },
            { name: 'Imam Al Mahdi(as)', match: 'Imam Al Mahdi(as)', id: 28 }
        ];
        const wudhuSteps = [
            { name: 'Rinse Mouth', id: 1, category: 'mustahab', order: 1 },
            { name: 'Rinse Nose', id: 2, category: 'mustahab', order: 2 },
            { name: 'Wash Hands', id: 3, category: 'mustahab', order: 3 },
            { name: 'Niyyah', id: 4, category: 'obligatory', order: 1 },
            { name: 'Wash Face', id: 5, category: 'obligatory', order: 2 },
            { name: 'Wash Right Arm', id: 6, category: 'obligatory', order: 3 },
            { name: 'Wash Left Arm', id: 7, category: 'obligatory', order: 4 },
            { name: 'Wipe Head', id: 8, category: 'obligatory', order: 5 },
            { name: 'Wipe Right Foot', id: 9, category: 'obligatory', order: 6 },
            { name: 'Wipe Left Foot', id: 10, category: 'obligatory', order: 7 }
        ];
        const storyData = {
            mecca: {
                start: {
                    text: "You are a young child named Amir living in Mecca during the time of Prophet Muhammad (s). One day, you see a group of people gathered near the Kaaba, listening to the Prophet (s) speak. You want to get closer, but itâ€™s crowded. What do you do?",
                    choices: {
                        a: { text: "Push through the crowd to get closer.", next: "pushThrough" },
                        b: { text: "Wait patiently at the edge and listen from afar.", next: "waitPatiently" },
                        c: { text: "Ask an adult to help you move forward.", next: "askAdult" }
                    },
                    background: "https://example.com/desert.jpg",
                    animation: "happy"
                },
                pushThrough: {
                    text: "You push through the crowd and accidentally bump into an elder. He looks upset but smiles when you apologize. The Prophet (s) notices and praises your honesty. You learn a lesson about respect.",
                    choices: {
                        a: { text: "Thank the Prophet (s) and return home.", next: "endGood" },
                        b: { text: "Stay and listen more.", next: "listenMore" }
                    },
                    background: "https://example.com/market.jpg",
                    animation: "happy"
                },
                waitPatiently: {
                    text: "You wait patiently and hear the Prophet (s) teach about kindness. A kind man offers you a spot to sit. You feel proud of your patience.",
                    choices: {
                        a: { text: "Share your spot with another child.", next: "endGood" },
                        b: { text: "Keep it to yourself.", next: "endBad" }
                    },
                    background: "https://example.com/desert.jpg",
                    animation: "neutral"
                },
                askAdult: {
                    text: "You ask an adult for help, and they kindly guide you closer. The Prophet (s) smiles at you and speaks about helping others. You feel grateful.",
                    choices: {
                        a: { text: "Help another child get closer too.", next: "endGood" },
                        b: { text: "Stay quiet and enjoy the moment.", next: "endNeutral" }
                    },
                    background: "https://example.com/market.jpg",
                    animation: "happy"
                },
                listenMore: {
                    text: "You stay and learn more about faith. The Prophet (s) invites you to join a small gathering later, teaching you about community.",
                    choices: { a: { text: "Join the gathering.", next: "endGood" } },
                    background: "https://example.com/night.jpg",
                    animation: "happy"
                },
                endGood: {
                    text: "Your choice leads to a rewarding lesson! You grow wiser and earn the respect of your community. +5 Stars!",
                    choices: { a: { text: "See your path.", next: "summary" } },
                    background: "https://example.com/desert.jpg",
                    animation: "happy"
                },
                endBad: {
                    text: "Your selfishness disappoints others. You learn to be more generous next time. +1 Star.",
                    choices: { a: { text: "See your path.", next: "summary" } },
                    background: "https://example.com/desert.jpg",
                    animation: "sad"
                },
                endNeutral: {
                    text: "You enjoy the moment but miss a chance to help. +2 Stars.",
                    choices: { a: { text: "See your path.", next: "summary" } },
                    background: "https://example.com/market.jpg",
                    animation: "neutral"
                },
                summary: {
                    text: "Your Journey: [Path will be listed here]. Would you like to start over?",
                    choices: { a: { text: "Restart", next: "start" } },
                    background: "https://example.com/desert.jpg",
                    animation: "neutral"
                }
            },
            kufa: {
                start: {
                    text: "You are a young child named Zainab living in Kufa during the holy khilafah of Imam Ali (as). One day, you hear that Imam Ali (as) is teaching justice in the marketplace. You want to learn, but there are challenges. What do you do?",
                    choices: {
                        a: { text: "Join the crowd and listen quietly.", next: "listenQuietly" },
                        b: { text: "Offer to help a struggling elder reach the front.", next: "helpElder" },
                        c: { text: "Ask a friend to explain later instead.", next: "askFriend" }
                    },
                    background: "https://example.com/kufa-market.jpg",
                    animation: "happy"
                },
                listenQuietly: {
                    text: "You listen quietly and learn about fairness from Imam Ali (as). A guard notices your focus and praises your respect.",
                    choices: {
                        a: { text: "Share the lesson with a sibling at home.", next: "shareLesson" },
                        b: { text: "Keep it to yourself and leave.", next: "keepQuiet" }
                    },
                    background: "https://example.com/kufa-day.jpg",
                    animation: "neutral"
                },
                helpElder: {
                    text: "You help an elder to the front, and Imam Ali (as) smiles at your kindness, teaching about compassion.",
                    choices: {
                        a: { text: "Assist another person too.", next: "assistMore" },
                        b: { text: "Return to your spot after helping.", next: "returnSpot" }
                    },
                    background: "https://example.com/kufa-market.jpg",
                    animation: "happy"
                },
                askFriend: {
                    text: "You ask a friend, but their explanation is unclear. You miss the full lesson but gain a chance to try again.",
                    choices: {
                        a: { text: "Go back to the marketplace tomorrow.", next: "tryAgain" },
                        b: { text: "Give up and play instead.", next: "giveUp" }
                    },
                    background: "https://example.com/kufa-night.jpg",
                    animation: "sad"
                },
                shareLesson: {
                    text: "Sharing the lesson with your sibling earns you praise from your family. +5 Stars!",
                    choices: { a: { text: "See your path.", next: "summaryKufa" } },
                    background: "https://example.com/kufa-home.jpg",
                    animation: "happy"
                },
                keepQuiet: {
                    text: "Keeping it to yourself limits your growth. +1 Star.",
                    choices: { a: { text: "See your path.", next: "summaryKufa" } },
                    background: "https://example.com/kufa-day.jpg",
                    animation: "sad"
                },
                assistMore: {
                    text: "Helping more people impresses Imam Ali (as), who teaches you about community service. +5 Stars!",
                    choices: { a: { text: "See your path.", next: "summaryKufa" } },
                    background: "https://example.com/kufa-market.jpg",
                    animation: "happy"
                },
                returnSpot: {
                    text: "Returning to your spot shows humility. +3 Stars.",
                    choices: { a: { text: "See your path.", next: "summaryKufa" } },
                    background: "https://example.com/kufa-day.jpg",
                    animation: "neutral"
                },
                tryAgain: {
                    text: "Going back tomorrow lets you learn directly from Imam Ali (as). +3 Stars.",
                    choices: { a: { text: "See your path.", next: "summaryKufa" } },
                    background: "https://example.com/kufa-market.jpg",
                    animation: "happy"
                },
                giveUp: {
                    text: "Giving up means missing a valuable lesson. +1 Star.",
                    choices: { a: { text: "See your path.", next: "summaryKufa" } },
                    background: "https://example.com/kufa-night.jpg",
                    animation: "sad"
                },
                summaryKufa: {
                    text: "Your Journey: [Path will be listed here]. Would you like to start over?",
                    choices: { a: { text: "Restart", next: "start" } },
                    background: "https://example.com/kufa-home.jpg",
                    animation: "neutral"
                }
            }
        };
        const missions = [
            { id: 'salah', title: 'Daily Salah', question: 'How many daily prayers?', type: 'text', answer: '5' },
            { id: 'dua', title: 'Learn Dua', question: 'Dua before eating?', type: 'text', answer: 'Bismillah' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // Ensure initial UI state
            const landingPage = document.getElementById('landing-page');
            const welcomeSection = document.getElementById('welcome');
            const profileSection = document.getElementById('profile');
            if (landingPage) landingPage.style.display = 'block';
            if (welcomeSection) welcomeSection.classList.add('hidden');
            if (profileSection) profileSection.classList.add('hidden');

            // Initialize modals
            ['login-modal', 'signup-modal', 'admin-login-modal', 'reset-password-modal'].forEach(id => {
                const modal = document.getElementById(id);
                if (modal) modal.style.display = 'none';
            });

            // Authentication state listener
            let authInitialized = false;
            const initAuth = () => {
                if (authInitialized) return;
                authInitialized = true;

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userData.email = user.email;
                        loadUserData();
                        document.getElementById('login-modal').style.display = 'none';
                        document.getElementById('landing-page').style.display = 'none';
                        document.getElementById('welcome').classList.remove('hidden');
                        showSection('welcome'); // Ensure immediate transition
                    } else {
                        userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
                        localStorage.removeItem('userData');
                        if (landingPage) landingPage.style.display = 'block';
                        if (welcomeSection) welcomeSection.classList.add('hidden');
                        if (profileSection) profileSection.classList.add('hidden');
                        ['login-modal', 'signup-modal', 'admin-login-modal', 'reset-password-modal'].forEach(id => {
                            const modal = document.getElementById(id);
                            if (modal) modal.style.display = 'none';
                        });
                    }
                }, (error) => {
                    console.error('Auth error:', error.message);
                    alert('Authentication failed. Please try again or contact support.');
                    if (landingPage) landingPage.style.display = 'block';
                });
            };

            initAuth();

            // Define global modal functions
            window.showLoginModal = function() {
                const modal = document.getElementById('login-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('Login modal shown');
                } else {
                    console.error('Login modal not found');
                }
            };

            window.showSignupModal = function() {
                const modal = document.getElementById('signup-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('Sign up modal shown');
                } else {
                    console.error('Signup modal not found');
                }
            };

            window.showAdminLoginModal = function() {
                const modal = document.getElementById('admin-login-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('Admin login modal shown');
                } else {
                    console.error('Admin login modal not found');
                }
            };

            window.showSection = function(sectionId) {
                document.querySelectorAll('.section, #landing-page, #hero').forEach(el => el.classList.add('hidden'));
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('hidden');
                    gsap.from(`#${sectionId.replace(/ /g, '-')}`, { opacity: 0, y: 50, duration: 0.5, ease: 'power2.out' });
                    if (sectionId === 'Level-1') showQuestion();
                    if (sectionId === 'Level-2') initMemoryGame();
                    if (sectionId === 'Level-3') initWudhuChallenge();
                    if (sectionId === 'Level-4') showKarbala();
                    if (sectionId === 'Level-5') initArtZone();
                    if (sectionId === 'Level-6') showHajj();
                    if (sectionId === 'Level-7') startStory();
                    if (sectionId === 'missions') showMissions();
                    if (sectionId === 'profile' && userData.email) showProfile();
                    updateProgress();
                    updateBadges();
                }
            };

            window.checkAnswer = function(answer) {
                const q = questions[userData.year][currentQuestion];
                if (q.type === 'text') answer = document.getElementById('answer-input').value;
                if (answer.toLowerCase() === q.answer.toLowerCase()) {
                    score++;
                    userData.stars += 2;
                    userData.progress = Math.min(userData.progress + 1, 10);
                    if (score === 1) userData.badges.push('Scholar');
                    updateStarCounter();
                    updateProgress();
                    updateBadges();
                    document.getElementById('score').innerHTML = `<p class="text-green-600">Correct! ğŸ‰ Score: ${score}/${questions[userData.year].length}</p>`;
                    confetti();
                } else document.getElementById('score').innerHTML = `<p class="text-red-600">Wrong! ğŸ˜• Answer: ${q.answer}</p>`;
                currentQuestion++;
                if (currentQuestion < questions[userData.year].length) {
                    setTimeout(showNextQuestion, 1000);
                } else {
                    document.getElementById('score').innerHTML += '<p class="mt-4 text-green-600">Quest Done! ğŸ‰</p>';
                }
            };

            window.signupUser = function() {
                userData.name = document.getElementById('signup-name').value || 'Young Explorer';
                userData.gender = document.querySelector('input[name="gender"]:checked').value;
                userData.year = document.getElementById('year-select').value;
                const selected = document.querySelector('.character.selected');
                userData.character = selected ? selected.src : document.querySelector('.character').src;
                saveUserData();

                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        alert("âœ… Sign-up successful!");
                        userData.email = email;
                        closeModal({ target: { className: 'modal' } });
                        loadUserData();
                        showSection('welcome');
                    })
                    .catch(error => alert("âŒ " + error.message));
            };

            window.login = function() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                signInWithEmailAndPassword(auth, email, password)
                    .then(() => {
                        alert("âœ… Login successful!");
                        userData.email = email;
                        loadUserData();
                    })
                    .catch(error => alert("âŒ " + error.message));
            };

            window.resetPassword = function() {
                const email = document.getElementById('reset-email').value;
                sendPasswordResetEmail(auth, email)
                    .then(() => alert("ğŸ“§ Password reset email sent!"))
                    .catch(error => alert("âŒ " + error.message));
            };

            window.logout = function() {
                signOut(auth).then(() => {
                    alert("âœ… Logged out successfully!");
                    userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
                    localStorage.removeItem('userData');
                    document.getElementById('landing-page').style.display = 'block';
                    document.getElementById('welcome').classList.add('hidden');
                    document.getElementById('profile').classList.add('hidden');
                    document.getElementById('avatar-display').style.display = 'none';
                    document.getElementById('star-count').textContent = '0 â­';
                    ['Level-1', 'Level-2', 'Level-3', 'Level-4', 'Level-5', 'Level-6', 'Level-7', 'missions'].forEach(id => {
                        const section = document.getElementById(id);
                        if (section) section.classList.add('hidden');
                    });
                }).catch(error => alert("âŒ " + error.message));
            };

            function loadUserData() {
                const saved = localStorage.getItem('userData');
                if (saved) {
                    userData = JSON.parse(saved);
                    if (!userData.badges) userData.badges = ['Explorer'];
                    document.getElementById('avatar-display').src = userData.character || 'https://yourusername.github.io/your-repo/images/mascot.png';
                    document.getElementById('avatar-display').style.display = 'block';
                    document.getElementById('welcome-name').textContent = userData.name || 'Young Explorer';
                    updateStarCounter();
                    updateProgress();
                    updateBadges();
                    document.getElementById('landing-page').style.display = 'none';
                    document.getElementById('welcome').classList.remove('hidden');
                    showSection('welcome');
                } else {
                    document.getElementById('landing-page').style.display = 'block';
                    document.getElementById('welcome').classList.add('hidden');
                    document.getElementById('profile').classList.add('hidden');
                }
            }

            function saveUserData() {
                localStorage.setItem('userData', JSON.stringify(userData));
            }

            document.querySelectorAll('.character').forEach(img => {
                img.addEventListener('click', () => {
                    document.querySelectorAll('.character').forEach(i => i.classList.remove('selected'));
                    img.classList.add('selected');
                    userData.character = img.src;
                    document.getElementById('avatar-display').src = userData.character;
                    saveUserData();
                });
            });

            window.closeModal = function(event) {
                if (event.target.classList.contains('modal') || event.target.classList.contains('btn')) {
                    const modalId = event.target.closest('.modal')?.id;
                    if (modalId) document.getElementById(modalId).style.display = 'none';
                    document.getElementById('landing-page').style.display = 'block';
                    document.getElementById('welcome').classList.add('hidden');
                    document.getElementById('profile').classList.add('hidden');
                    console.log('Modal closed via backdrop or button');
                }
            };

            window.loginAdmin = function() {
                const email = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                const adminEmail = 'melzein1987@gmail.com';
                const adminPassword = 'admin123';
                if (email === adminEmail && password === adminPassword) {
                    alert('Admin login successful!');
                    closeModal({ target: { className: 'modal' } });
                    // Add admin dashboard logic here if needed
                } else {
                    alert('Invalid admin credentials!');
                }
            };

            function showQuestion() {
                currentQuestion = 0;
                score = 0;
                const container = document.getElementById('Level-1');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Quiz Challenge ğŸ“–</h2>
                    <img src="https://yourusername.github.io/your-repo/images/allah_symbol.jpg" alt="Quiz" class="karbala-img mx-auto mb-4">
                    <div id="quiz-container" class="text-lg mb-4"></div>
                    <div id="score" class="text-xl mb-4"></div>
                    <button class="btn" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
                showNextQuestion();
            }

            function showNextQuestion() {
                const q = questions[userData.year][currentQuestion];
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.innerHTML = `<p class="mb-4">${q.question}</p>` +
                    (q.type === 'text' ? `<input id="answer-input" class="border rounded-lg p-2 bg-white text-black mx-auto block mt-4 w-1/2" placeholder="Type your answer"><button class="btn ml-2" onclick="checkAnswer()">Submit ğŸ‰</button>` :
                    q.options.map(o => `<button class="btn ml-2 mt-2" onclick="checkAnswer('${o}')">${o} ğŸŒŸ</button>`).join(''));
            }

            function initMemoryGame() {
                const container = document.getElementById('Level-2');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Memory Quest ğŸ§ </h2>
                    <div id="memory-game" class="grid grid-cols-4 md:grid-cols-7 gap-4 p-4"></div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
                const gameContainer = document.getElementById('memory-game');
                const shuffledCards = [...memoryCards].sort(() => Math.random() - 0.5);
                gameContainer.innerHTML = '';
                shuffledCards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'memory-card';
                    cardElement.dataset.name = card.name;
                    cardElement.dataset.match = card.match;
                    cardElement.textContent = 'â“';
                    cardElement.addEventListener('click', () => flipCard(cardElement));
                    gameContainer.appendChild(cardElement);
                });
            }

            function flipCard(card) {
                if (lock || flippedCards.length >= 2 || card.classList.contains('matched')) return;
                card.textContent = card.dataset.name;
                flippedCards.push(card);
                if (flippedCards.length === 2) {
                    lock = true;
                    setTimeout(checkMatch, 1000);
                }
            }

            function checkMatch() {
                const [card1, card2] = flippedCards;
                if (card1.dataset.match === card2.dataset.match) {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedCards.push(card1, card2);
                    userData.stars += 1;
                    updateStarCounter();
                    if (matchedCards.length === memoryCards.length) {
                        userData.stars += 10;
                        userData.progress = Math.min(userData.progress + 1, 10);
                        userData.badges.push('Memory Master');
                        updateProgress();
                        updateBadges();
                        confetti();
                        const container = document.getElementById('Level-2');
                        const message = document.createElement('p');
                        message.className = 'text-green-600 text-xl mt-4';
                        message.textContent = 'All 28 cards matched! +10 Bonus Stars! ğŸ‰';
                        container.appendChild(message);
                    }
                } else {
                    setTimeout(() => {
                        card1.textContent = 'â“';
                        card2.textContent = 'â“';
                    }, 1000);
                }
                flippedCards = [];
                lock = false;
            }

            function initWudhuChallenge() {
                const container = document.getElementById('Level-3');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Wudhu Challenge ğŸ’§</h2>
                    <div class="wudhu-container">
                        <div class="wudhu-dropzone" id="obligatory-dropzone">
                            <h3 class="text-xl mb-4">Obligatory ğŸ“–</h3>
                        </div>
                        <div class="wudhu-dropzone" id="mustahab-dropzone">
                            <h3 class="text-xl mb-4">Mustahab ğŸŒ±</h3>
                        </div>
                    </div>
                    <div id="wudhu-source" class="grid grid-cols-3 gap-2 mt-4"></div>
                    <div class="mt-4">
                        <button id="wudhu-submit" class="btn mr-2">Submit ğŸ‰</button>
                        <button id="wudhu-reset" class="btn">Reset ğŸ”„</button>
                    </div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);

                const source = document.getElementById('wudhu-source');
                wudhuSteps.forEach(step => {
                    const stepElement = document.createElement('div');
                    stepElement.className = 'wudhu-step';
                    stepElement.draggable = true;
                    stepElement.dataset.id = step.id;
                    stepElement.dataset.category = step.category;
                    stepElement.dataset.order = step.order;
                    stepElement.textContent = step.name;
                    stepElement.addEventListener('dragstart', dragStartWudhu);
                    source.appendChild(stepElement);
                });

                const obligatoryDropzone = document.getElementById('obligatory-dropzone');
                const mustahabDropzone = document.getElementById('mustahab-dropzone');
                [obligatoryDropzone, mustahabDropzone].forEach(dropzone => {
                    dropzone.addEventListener('dragover', dragOverWudhu);
                    dropzone.addEventListener('drop', dropWudhu);
                });

                document.getElementById('wudhu-submit').addEventListener('click', checkWudhuCompletion);
                document.getElementById('wudhu-reset').addEventListener('click', resetWudhuChallenge);
            }

            let draggedWudhu;
            function dragStartWudhu(event) {
                draggedWudhu = event.target;
                event.dataTransfer.setData('text/plain', draggedWudhu.textContent);
                event.dataTransfer.setData('id', draggedWudhu.dataset.id);
                event.dataTransfer.setData('category', draggedWudhu.dataset.category);
                event.dataTransfer.setData('order', draggedWudhu.dataset.order);
                event.dataTransfer.effectAllowed = 'move';
            }

            function dragOverWudhu(event) {
                event.preventDefault();
                event.dataTransfer.dropEffect = 'move';
            }

            function dropWudhu(event) {
                event.preventDefault();
                const dropzone = event.target.closest('.wudhu-dropzone');
                if (!dropzone || !draggedWudhu) return;

                const category = event.dataTransfer.getData('category');
                if ((dropzone.id === 'obligatory-dropzone' && category === 'obligatory') ||
                    (dropzone.id === 'mustahab-dropzone' && category === 'mustahab')) {
                    const existing = dropzone.querySelector(`.wudhu-step[data-id="${event.dataTransfer.getData('id')}"]`);
                    if (existing) existing.remove();
                    const step = draggedWudhu.cloneNode(true);
                    step.draggable = true;
                    step.dataset.id = event.dataTransfer.getData('id');
                    step.dataset.category = category;
                    step.dataset.order = event.dataTransfer.getData('order');
                    step.addEventListener('dragstart', dragStartWudhu);
                    dropzone.appendChild(step);
                    if (draggedWudhu.parentElement.id === 'wudhu-source') {
                        draggedWudhu.remove();
                    }
                    draggedWudhu = null;
                }
            }

            function checkWudhuCompletion() {
                const obligatoryDropzone = document.getElementById('obligatory-dropzone');
                const mustahabDropzone = document.getElementById('mustahab-dropzone');

                const obligatorySteps = Array.from(obligatoryDropzone.querySelectorAll('.wudhu-step'));
                const mustahabSteps = Array.from(mustahabDropzone.querySelectorAll('.wudhu-step'));

                const isObligatoryCorrect = obligatorySteps.length === 7 && obligatorySteps.every((step, index) => 
                    parseInt(step.dataset.order) === index + 1);
                const isMustahabCorrect = mustahabSteps.length === 3 && mustahabSteps.every((step, index) => 
                    parseInt(step.dataset.order) === index + 1);

                if (isObligatoryCorrect && isMustahabCorrect) {
                    obligatorySteps.forEach(step => step.classList.add('correct'));
                    mustahabSteps.forEach(step => step.classList.add('correct'));
                    userData.stars += 10;
                    userData.progress = Math.min(userData.progress + 1, 10);
                    userData.badges.push('Wudhu Master');
                    updateStarCounter();
                    updateProgress();
                    updateBadges();
                    confetti();
                    const message = document.createElement('p');
                    message.className = 'text-green-600 text-xl mt-4';
                    message.textContent = 'Wudhu Challenge Completed! +10 Stars! ğŸ‰';
                    document.getElementById('Level-3').appendChild(message);
                } else {
                    alert('Please sort and order all 10 steps correctly in their respective sections! ğŸ˜•');
                }
            }

            function resetWudhuChallenge() {
                initWudhuChallenge();
            }

            function showKarbala() {
                const container = document.getElementById('Level-4');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Karbala Epic ğŸ°</h2>
                    <p class="text-lg mb-4">Discover Imam Hussain's bravery!</p>
                    <img src="https://yourusername.github.io/your-repo/images/karbala.jpg" alt="Karbala" class="karbala-img mx-auto mb-4">
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
                userData.stars += 1;
                userData.progress = Math.min(userData.progress + 1, 10);
                updateStarCounter();
                updateProgress();
                if (userData.progress === 10) userData.badges.push('Karbala Hero');
                updateBadges();
            }

            function showHajj() {
                const container = document.getElementById('Level-6');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Explore Hajj ğŸŒ</h2>
                    <p class="text-lg mb-4">Learn about the pilgrimage!</p>
                    <img src="https://yourusername.github.io/your-repo/images/hajj.jpg" alt="Hajj" class="karbala-img mx-auto mb-4">
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
                userData.stars += 1;
                userData.progress = Math.min(userData.progress + 1, 10);
                updateStarCounter();
                updateProgress();
                if (userData.progress === 10) userData.badges.push('Hajj Explorer');
                updateBadges();
            }

            function initArtZone() {
                const container = document.getElementById('Level-5');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Art Quest ğŸ¨</h2>
                    <canvas id="art-canvas" width="600" height="400"></canvas>
                    <div class="art-tools mt-4">
                        <button class="btn" onclick="changeColor('red')">Red â¤ï¸</button>
                        <button class="btn" onclick="changeColor('blue')">Blue ğŸ’™</button>
                        <button class="btn" onclick="changeColor('green')">Green ğŸ’š</button>
                        <button class="btn" onclick="changeColor('yellow')">Yellow ğŸŒŸ</button>
                        <button class="btn" onclick="changeColor('pink')">Pink ğŸ’—</button>
                        <button class="btn" onclick="changeColor('purple')">Purple ğŸ’œ</button>
                        <button class="btn" onclick="changeColor('orange')">Orange ğŸŠ</button>
                        <button class="btn" onclick="loadImage('https://yourusername.github.io/your-repo/images/kaaba.jpg')">Kaaba ğŸ•‹</button>
                        <button class="btn" onclick="loadImage('https://via.placeholder.com/600x400?text=Masjid')">Masjid ğŸ•Œ</button>
                        <button class="btn" onclick="clearCanvas()">Clear ğŸ§¹</button>
                        <button class="btn" onclick="undoDrawing()">Undo â†©ï¸</button>
                    </div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
                const canvas = document.getElementById('art-canvas');
                const ctx = canvas.getContext('2d');
                let drawing = false;
                let color = 'black';
                let undoStack = [];

                canvas.addEventListener('mousedown', () => drawing = true);
                canvas.addEventListener('mouseup', () => { drawing = false; undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height)); });
                canvas.addEventListener('mouseleave', () => drawing = false);
                canvas.addEventListener('mousemove', (e) => {
                    if (drawing) {
                        ctx.fillStyle = color;
                        ctx.beginPath();
                        ctx.arc(e.offsetX, e.offsetY, 5, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });

                window.changeColor = function(newColor) { color = newColor; };
                window.clearCanvas = function() { ctx.clearRect(0, 0, canvas.width, canvas.height); undoStack = []; };
                window.loadImage = function(src) {
                    const img = new Image();
                    img.onload = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                    };
                    img.onerror = () => {
                        console.log(`Image load failed for ${src}`);
                        alert('Failed to load image. Using fallback. Check the URL!');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#ccc';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                    };
                    img.src = src;
                };
                window.undoDrawing = function() {
                    if (undoStack.length > 1) {
                        undoStack.pop(); // Remove current state
                        ctx.putImageData(undoStack.pop(), 0, 0);
                    }
                };
                userData.stars += 1;
                userData.progress = Math.min(userData.progress + 1, 10);
                if (userData.progress === 10) userData.badges.push('Art Master');
                updateStarCounter();
                updateProgress();
                updateBadges();
            }

            function startStory() {
                userData.storyPath = [];
                const storyOptions = ['mecca', 'kufa'];
                const selectedStory = storyOptions[Math.floor(Math.random() * storyOptions.length)];
                showStoryScene(selectedStory + '.start');
            }

            function showStoryScene(sceneId) {
                const [story, scene] = sceneId.split('.');
                const fullScene = storyData[story][scene];
                userData.storyPath.push({ id: sceneId, choice: null });
                const container = document.getElementById('Level-7');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Choose Your Path ğŸ“–</h2>
                    <div class="story-card">
                        <p>${fullScene.text}</p>
                        ${Object.entries(fullScene.choices).map(([key, choice]) => `
                            <button class="choice-btn" onclick="makeChoice('${story}', '${scene}', '${key}', '${choice.next}')">${choice.text}</button>
                        `).join('')}
                        ${['summary', 'summaryKufa'].includes(scene) ? `<p>Your path: ${userData.storyPath.map(s => s.id).join(' -> ')}</p>` : ''}
                    </div>
                    ${!['start', 'summary', 'summaryKufa'].includes(scene) ? '<button class="btn mt-4" onclick="goBack()">Back</button>' : ''}
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>
                    <div class="lottie-animation" id="story-animation"></div>`;
                container.appendChild(content);
                document.getElementById('story-background').style.backgroundImage = `url(${fullScene.background})`;
                loadAnimation(fullScene.animation);
                gsap.from('.story-card', { opacity: 0, y: 50, duration: 0.5, ease: 'power2.out' });
            }

            function makeChoice(story, scene, choiceKey, nextScene) {
                const fullScene = storyData[story][scene];
                userData.storyPath[userData.storyPath.length - 1].choice = choiceKey;
                let nextFullScene = nextScene;
                if (story === 'mecca' && nextScene === 'endGood') { userData.stars += 5; }
                else if (story === 'mecca' && nextScene === 'endBad') { userData.stars += 1; }
                else if (story === 'mecca' && nextScene === 'endNeutral') { userData.stars += 2; }
                else if (story === 'kufa' && nextScene === 'shareLesson') { userData.stars += 5; }
                else if (story === 'kufa' && nextScene === 'keepQuiet') { userData.stars += 1; }
                else if (story === 'kufa' && nextScene === 'assistMore') { userData.stars += 5; }
                else if (story === 'kufa' && nextScene === 'returnSpot') { userData.stars += 3; }
                else if (story === 'kufa' && nextScene === 'tryAgain') { userData.stars += 3; }
                else if (story === 'kufa' && nextScene === 'giveUp') { userData.stars += 1; }
                if (nextScene === 'summary' || nextScene === 'summaryKufa') {
                    nextFullScene = story + '.' + nextScene;
                }
                userData.progress = Math.min(userData.progress + 1, 10);
                updateStarCounter();
                updateProgress();
                saveUserData();
                showStoryScene(nextFullScene);
            }

            function goBack() {
                if (userData.storyPath.length > 1) {
                    userData.storyPath.pop();
                    const prevScene = userData.storyPath[userData.storyPath.length - 1].id;
                    showStoryScene(prevScene);
                }
            }

            function loadAnimation(type) {
                const animationContainer = document.getElementById('story-animation');
                if (animationContainer && document.getElementById('Level-7').classList.contains('hidden') === false) {
                    let animationData;
                    try {
                        switch (type) {
                            case 'happy': animationData = { path: 'https://assets10.lottiefiles.com/packages/lf20_5d6w4w8k.json' }; break;
                            case 'sad': animationData = { path: 'https://assets10.lottiefiles.com/packages/lf20_6l1q5q8t.json' }; break;
                            case 'neutral': animationData = { path: 'https://assets10.lottiefiles.com/packages/lf20_wl3khqiv.json' }; break;
                            default: animationData = { path: 'https://assets10.lottiefiles.com/packages/lf20_5d6w4w8k.json' };
                        }
                        lottie.loadAnimation({
                            container: animationContainer,
                            renderer: 'svg',
                            loop: true,
                            autoplay: true,
                            animationData: animationData,
                            width: 200,
                            height: 200
                        });
                    } catch (error) {
                        console.error('Lottie animation error:', error);
                        animationContainer.innerHTML = '<p>Animation failed to load. Check console for details.</p>';
                    }
                }
            }

            function showMissions() {
                const container = document.getElementById('missions');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Mission Board â­</h2>
                    ${missions.map(mission => `
                        <div class="story-card mb-4">
                            <h3 class="text-xl">${mission.title}</h3>
                            <p>${mission.question}</p>
                            <input id="mission-${mission.id}-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                            <button class="btn mt-2" onclick="checkMission('${mission.id}', '${mission.answer}')">Submit ğŸ‰</button>
                        </div>
                    `).join('')}
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
            }

            function checkMission(id, answer) {
                const userAnswer = document.getElementById(`mission-${id}-input`).value.toLowerCase();
                if (userAnswer === answer.toLowerCase()) {
                    userData.stars += 2;
                    userData.progress = Math.min(userData.progress + 1, 10);
                    userData.missions[id] = true;
                    updateStarCounter();
                    updateProgress();
                    confetti();
                    const feedback = document.createElement('p');
                    feedback.className = 'text-green-600 mt-2';
                    feedback.textContent = 'Mission Complete! +2 Stars! ğŸ‰';
                    document.getElementById(`mission-${id}-input`).parentElement.appendChild(feedback);
                } else {
                    const feedback = document.createElement('p');
                    feedback.className = 'text-red-600 mt-2';
                    feedback.textContent = 'Wrong! Try again! ğŸ˜•';
                    document.getElementById(`mission-${id}-input`).parentElement.appendChild(feedback);
                }
            }

            function showProfile() {
                if (!userData.email) {
                    alert("Please log in to view your profile!");
                    showSection('welcome');
                    return;
                }
                const container = document.getElementById('profile');
                container.innerHTML = '';
                const content = document.createElement('div');
                content.className = 'content';
                content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Profile ğŸ¡</h2>
                    <p>Email: ${userData.email || 'Not set'}</p>
                    <p>Name: ${userData.name}</p>
                    <p>Level: ${userData.year}</p>
                    <p>Stars: <span id="profile-star-count">${userData.stars}</span> â­</p>
                    <p>Progress: <span id="profile-progress">${userData.progress}/10</span></p>
                    <p>Badges: ${userData.badges.join(', ')}</p>
                    <img src="${userData.character || 'https://yourusername.github.io/your-repo/images/mascot.png'}" alt="Avatar" class="w-32 h-32 rounded-full mx-auto mt-4">
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home ğŸ¡</button>
                    <button class="btn mt-2" onclick="logout()">Logout ğŸšª</button>`;
                container.appendChild(content);
                updateStarCounter();
                updateProgress();
            }

            function updateStarCounter() {
                document.getElementById('star-count').textContent = userData.stars;
                if (document.getElementById('profile-star-count')) document.getElementById('profile-star-count').textContent = userData.stars;
                saveUserData();
            }

            function updateProgress() {
                const progressElement = document.getElementById('progress');
                if (progressElement) {
                    const progress = (userData.progress / 10) * 100;
                    progressElement.style.width = `${progress}%`;
                }
                if (document.getElementById('profile-progress')) document.getElementById('profile-progress').textContent = `${userData.progress}/10`;
                saveUserData();
            }

            function updateBadges() {
                const badgeElement = document.querySelector('.badge');
                if (badgeElement) badgeElement.textContent = `ğŸ… Badge: ${userData.badges[userData.badges.length - 1] || 'Explorer'}`;
                saveUserData();
            }

            function confetti() {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            window.addEventListener('load', () => {
                document.getElementById('landing-page').style.display = 'block';
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
            });
        });
    </script>
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            background: #87CEEB url('https://yourusername.github.io/your-repo/images/background.jpg') no-repeat center center fixed;
            background-size: cover;
            overflow: hidden;
            z-index: 0;
        }
        .header-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(90deg, #FFA500, #FF4500);
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-bar h1 {
            color: #fff;
            font-size: 1.8rem;
            text-shadow: 2px 2px #000;
            animation: bounce 1s ease-out infinite;
        }
        .tree, .cloud, .star, .moon {
            position: absolute;
            animation: float 6s infinite ease-in-out;
            z-index: 1;
        }
        .tree { content: 'ğŸŒ³'; font-size: 80px; }
        .cloud { content: 'â˜ï¸'; font-size: 50px; animation: float 8s infinite ease-in-out; }
        .star { content: 'â­'; font-size: 30px; animation: twinkle 2s infinite alternate; }
        .moon { content: 'ğŸŒ™'; font-size: 60px; animation: shine 4s infinite ease-in-out; top: 10%; left: 10%; }
        .hero {
            height: 100vh;
            position: relative;
            overflow: hidden;
            color: #fff;
            text-align: center;
            padding-top: 10rem;
            border-radius: 0 0 50px 50px;
            display: block;
            z-index: 10;
            background: inherit;
        }
        .hero h1 {
            font-size: 3.5rem;
            animation: bounce 1s ease-out;
        }
        .hero p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            animation: fadeIn 1.5s ease-out;
        }
        .hero .btn {
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            color: #fff;
            padding: 2rem 4rem;
            font-size: 2rem;
            border-radius: 30px;
            transition: transform 0.3s, background 0.3s;
            text-shadow: 1px 1px #000;
            z-index: 30;
        }
        .hero .btn:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #32CD32, #87CEEB);
            box-shadow: 0 0 10px #32CD32;
        }
        .section {
            min-height: 100vh;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding-top: 80px;
        }
        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            color: #000;
            z-index: 20;
        }
        .card-grid {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            padding: 4rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 20;
            flex-wrap: wrap;
        }
        .card {
            background: linear-gradient(135deg, #FF69B4, #FFA500);
            border-radius: 30px;
            padding: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            text-align: center;
            overflow: hidden;
            width: 250px;
            z-index: 20;
        }
        .card:hover {
            transform: translateY(-15px);
            box-shadow: 0 15px 40px rgba(50, 205, 50, 0.3);
        }
        .card h3 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px #000;
        }
        .card p {
            color: #fff;
            text-shadow: 1px 1px #000;
        }
        .card:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
            z-index: -1;
        }
        .btn {
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            color: #fff;
            padding: 1rem 2rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1.2rem;
            transition: transform 0.3s, background 0.3s;
            text-shadow: 1px 1px #000;
            z-index: 1000;
            position: relative;
        }
        .btn:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #32CD32, #87CEEB);
            box-shadow: 0 0 10px #32CD32;
        }
        .btn:active {
            transform: scale(0.95);
        }
        .star-counter {
            position: fixed;
            top: 70px;
            right: 1rem;
            background: #fff;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            color: #FFA500;
            z-index: 50;
            animation: pulse 2s infinite;
        }
        .avatar-display {
            position: fixed;
            top: 6rem;
            left: 1rem;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid #FFA500;
            object-fit: cover;
            animation: float 3s infinite ease-in-out;
            z-index: 50;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 201;
        }
        .karbala-img {
            width: 100%;
            max-width: 250px;
            border-radius: 15px;
        }
        #art-canvas {
            border: 3px solid #87CEEB;
            border-radius: 20px;
            background: #fff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .art-tools {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        .memory-card {
            width: 150px;
            height: 150px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            overflow: hidden;
            z-index: 20;
        }
        .memory-card:hover {
            transform: scale(1.05);
        }
        .memory-card.matched {
            background: #32CD32;
            color: #fff;
        }
        .wudhu-step {
            width: 120px;
            height: 120px;
            background: #87CEEB;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: move;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            user-select: none;
            margin: 1rem 0;
            position: relative;
            z-index: 20;
        }
        .wudhu-step:hover {
            transform: rotate(10deg) scale(1.1);
        }
        .wudhu-step.correct {
            background: #32CD32;
            color: #fff;
        }
        .jigsaw-piece {
            width: 133px;
            height: 133px;
            background-size: cover;
            border: 2px solid #FFA500;
            cursor: move;
            position: absolute;
            user-select: none;
        }
        .jigsaw-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto;
            background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Kaaba_at_al-Masjid_al-Haram%2C_Makkah.jpg/400px-Kaaba_at_al-Masjid_al-Haram%2C_Makkah.jpg') no-repeat;
            background-size: 400px 400px;
            border: 2px solid #32CD32;
        }
        .story-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem auto;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: left;
            z-index: 20;
        }
        .choice-btn {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 15px;
            background: #FFA500;
            color: #fff;
            transition: transform 0.3s, background 0.3s;
            z-index: 30;
        }
        .choice-btn:hover {
            transform: scale(1.05);
            background: #32CD32;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        #progress {
            height: 100%;
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            width: 0%;
            transition: width 0.5s ease-in-out;
            border-radius: 10px;
        }
        .badge {
            background: #FFD700;
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            margin: 0.5rem;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 20;
        }
        .wudhu-container {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
        }
        .wudhu-dropzone {
            width: 45%;
            min-height: 300px;
            background: rgba(135, 206, 235, 0.5);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 20;
        }
        #story-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            z-index: 0;
        }
        .lottie-animation {
            margin: 1rem auto;
            width: 200px;
            height: 200px;
        }
        .hidden {
            display: none;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        @keyframes twinkle {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        @keyframes shine {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            .card {
                width: 120px;
                padding: 0.5rem;
            }
            .karbala-img {
                max-width: 200px;
            }
            .hero h1 {
                font-size: 2.5rem;
            }
            .hero .btn {
                padding: 1rem 2rem;
                font-size: 1.5rem;
            }
            .section {
                padding: 2rem 1rem;
            }
            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
            .memory-card {
                width: 100px;
                height: 100px;
            }
            .wudhu-step {
                width: 80px;
                height: 80px;
            }
            .wudhu-dropzone {
                min-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <h1>Shia Islamic Adventure Quest</h1>
    </div>
    <div class="star-counter" id="star-count">0 â­</div>
    <img src="https://yourusername.github.io/your-repo/images/mascot.png" alt="Avatar" class="avatar-display" id="avatar-display" style="display: none;">
    <div class="tree" style="top: 20%; left: 5%;"></div>
    <div class="cloud" style="top: 10%; right: 10%;"></div>
    <div class="star" style="top: 15%; left: 20%;"></div>
    <div class="moon" style="top: 10%; left: 10%;"></div>
    <div class="hero" id="hero">
        <h1>Welcome to Your Adventure!</h1>
        <p>Explore, learn, and grow with Shia Islamic teachings.</p>
        <button class="btn" onclick="showLoginModal()">Login ğŸšª</button>
        <button class="btn" onclick="showSignupModal()">Sign Up âœ¨</button>
    </div>
    <div id="landing-page" class="hidden">
        <div class="card-grid">
            <div class="card" onclick="showSection('Level-1')">
                <h3>Level 1</h3>
                <p>Quiz Challenge ğŸ“–</p>
            </div>
            <div class="card" onclick="showSection('Level-2')">
                <h3>Level 2</h3>
                <p>Memory Quest ğŸ§ </p>
            </div>
            <div class="card" onclick="showSection('Level-3')">
                <h3>Level 3</h3>
                <p>Wudhu Challenge ğŸ’§</p>
            </div>
            <div class="card" onclick="showSection('Level-4')">
                <h3>Level 4</h3>
                <p>Karbala Epic ğŸ°</p>
            </div>
            <div class="card" onclick="showSection('Level-5')">
                <h3>Level 5</h3>
                <p>Art Quest ğŸ¨</p>
            </div>
            <div class="card" onclick="showSection('Level-6')">
                <h3>Level 6</h3>
                <p>Explore Hajj ğŸŒ</p>
            </div>
            <div class="card" onclick="showSection('Level-7')">
                <h3>Level 7</h3>
                <p>Choose Your Path ğŸ“–</p>
            </div>
            <div class="card" onclick="showSection('missions')">
                <h3>Missions</h3>
                <p>Daily Tasks â­</p>
            </div>
            <div class="card" onclick="showSection('profile')">
                <h3>Profile</h3>
                <p>Your Journey ğŸ¡</p>
            </div>
        </div>
        <button class="btn mt-4" onclick="showAdminLoginModal()">Admin Login ğŸ”</button>
    </div>
    <div id="welcome" class="section hidden">
        <h2 class="text-3xl text-orange-600 mb-4">Welcome, <span id="welcome-name">Young Explorer</span>! ğŸŒŸ</h2>
        <div class="progress-bar">
            <div id="progress"></div>
        </div>
        <p class="badge"></p>
        <div class="card-grid">
            <div class="card" onclick="showSection('Level-1')">
                <h3>Level 1</h3>
                <p>Quiz Challenge ğŸ“–</p>
            </div>
            <div class="card" onclick="showSection('Level-2')">
                <h3>Level 2</h3>
                <p>Memory Quest ğŸ§ </p>
            </div>
            <div class="card" onclick="showSection('Level-3')">
                <h3>Level 3</h3>
                <p>Wudhu Challenge ğŸ’§</p>
            </div>
            <div class="card" onclick="showSection('Level-4')">
                <h3>Level 4</h3>
                <p>Karbala Epic ğŸ°</p>
            </div>
            <div class="card" onclick="showSection('Level-5')">
                <h3>Level 5</h3>
                <p>Art Quest ğŸ¨</p>
            </div>
            <div class="card" onclick="showSection('Level-6')">
                <h3>Level 6</h3>
                <p>Explore Hajj ğŸŒ</p>
            </div>
            <div class="card" onclick="showSection('Level-7')">
                <h3>Level 7</h3>
                <p>Choose Your Path ğŸ“–</p>
            </div>
            <div class="card" onclick="showSection('missions')">
                <h3>Missions</h3>
                <p>Daily Tasks â­</p>
            </div>
            <div class="card" onclick="showSection('profile')">
                <h3>Profile</h3>
                <p>Your Journey ğŸ¡</p>
            </div>
        </div>
        <button class="btn mt-4" onclick="showAdminLoginModal()">Admin Login ğŸ”</button>
        <button class="btn mt-4" onclick="logout()">Logout ğŸšª</button>
    </div>
    <div id="Level-1" class="section hidden"></div>
    <div id="Level-2" class="section hidden"></div>
    <div id="Level-3" class="section hidden"></div>
    <div id="Level-4" class="section hidden"></div>
    <div id="Level-5" class="section hidden"></div>
    <div id="Level-6" class="section hidden"></div>
    <div id="Level-7" class="section hidden">
        <div id="story-background"></div>
    </div>
    <div id="missions" class="section hidden"></div>
    <div id="profile" class="section hidden"></div>
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2>Login ğŸšª</h2>
            <input id="login-email" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Email" type="email">
            <input id="login-password" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Password" type="password">
            <button class="btn mt-4" onclick="login()">Login ğŸ‰</button>
            <button class="btn mt-2" onclick="showResetPasswordModal()">Forgot Password? ğŸ”‘</button>
            <button class="btn mt-2" onclick="closeModal(event)">Close âŒ</button>
        </div>
    </div>
    <div id="signup-modal" class="modal">
        <div class="modal-content">
            <h2>Sign Up âœ¨</h2>
            <input id="signup-name" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Name">
            <div class="mt-2">
                <label><input type="radio" name="gender" value="boy" checked> Boy ğŸ‘¦</label>
                <label class="ml-4"><input type="radio" name="gender" value="girl"> Girl ğŸ‘§</label>
            </div>
            <select id="year-select" class="border rounded-lg p-2 bg-white text-black mt-2 w-full">
                <option value="Level-1">Level 1</option>
                <option value="Level-2">Level 2</option>
                <option value="Level-3">Level 3</option>
                <option value="Level-4">Level 4</option>
                <option value="Level-5">Level 5</option>
                <option value="Level-6">Level 6</option>
                <option value="Level-7">Level 7</option>
            </select>
            <div class="character-select mt-2">
                <img src="https://yourusername.github.io/your-repo/images/mascot.png" alt="Boy" class="character w-16 h-16 mr-2">
                <img src="https://yourusername.github.io/your-repo/images/girl.png" alt="Girl" class="character w-16 h-16">
            </div>
            <input id="signup-email" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Email" type="email">
            <input id="signup-password" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Password" type="password">
            <button class="btn mt-4" onclick="signupUser()">Sign Up ğŸ‰</button>
            <button class="btn mt-2" onclick="closeModal(event)">Close âŒ</button>
        </div>
    </div>
    <div id="admin-login-modal" class="modal">
        <div class="modal-content">
            <h2>Admin Login ğŸ”</h2>
            <input id="admin-username" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Email" type="email">
            <input id="admin-password" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Password" type="password">
            <button class="btn mt-4" onclick="loginAdmin()">Login ğŸ‰</button>
            <button class="btn mt-2" onclick="closeModal(event)">Close âŒ</button>
        </div>
    </div>
    <div id="reset-password-modal" class="modal">
        <div class="modal-content">
            <h2>Reset Password ğŸ”‘</h2>
            <input id="reset-email" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Email" type="email">
            <button class="btn mt-4" onclick="resetPassword()">Send Reset Email ğŸ“§</button>
            <button class="btn mt-2" onclick="closeModal(event)">Close âŒ</button>
        </div>
    </div>
</body>
</html>