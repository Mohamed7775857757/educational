<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shia Islamic Learning Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swatch" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #10b981, #3b82f6);
            color: #1f2937;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .section {
            display: none;
            margin: 2rem auto;
            max-width: 900px;
        }
        .section.active {
            display: block;
        }
        .card {
            background: rgba(255, 255, 255, 0.95); /* White background for better visibility */
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            padding: 2rem;
        }
        .btn {
            background: linear-gradient(to bottom, #facc15, #f59e0b);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.5);
        }
        .avatar-display {
            position: fixed;
            top: 6rem;
            left: 1.5rem;
            width: 80px;
            height: 80px;
            border-radius: 0.75rem;
        }
        .star-counter {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 20; /* Ensure stars are above banner */
        }
        .karbala-img {
            width: 100%;
            max-width: 300px;
            border-radius: 1rem;
        }
        .character-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }
        .character {
            width: 100px;
            height: 100px;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .character:hover {
            transform: scale(1.1);
        }
        .character.selected {
            border: 3px solid #10b981;
        }
        .memory-card, .wudhu-step {
            width: 100px;
            height: 100px;
            background: #fed7aa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        .memory-card:hover, .wudhu-step:hover {
            transform: rotate(5deg);
        }
        .memory-card.matched, .wudhu-step.correct {
            background: #10b981;
        }
        .wudhu-step.correct {
            border: 3px solid #facc15;
        }
        .wudhu-container {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }
        .wudhu-obligatory, .wudhu-mustahab {
            width: 48%;
            padding: 1rem;
            border: 2px solid #3b82f6;
            border-radius: 0.75rem;
            min-height: 200px;
            background: rgba(255, 255, 255, 0.95); /* White background for visibility */
        }
        .art-tools {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }
        .art-image {
            width: 100px;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .art-image:hover {
            transform: scale(1.1);
        }
        .art-image.selected {
            border: 3px solid #10b981;
        }
        #art-canvas {
            border: 2px solid #3b82f6;
            border-radius: 0.75rem;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        nav {
            z-index: 10; /* Ensure nav is below star-counter */
        }
    </style>
</head>
<body>
    <nav class="fixed top-0 w-full bg-gray-900 bg-opacity-80 text-white z-10">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="text-2xl font-semibold">üåô Shia Islamic Learning Hub</div>
            <div class="space-x-4 hidden md:flex">
                <a href="#" class="hover:text-yellow-400" onclick="showSection('welcome')">Home</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('profile')">Profile</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('kindergarten')">Quiz</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('year1')">Memory Game</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('year2')">Wudhu Puzzle</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('year3')">Karbala Quest</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('year4')">Art Zone</a>
                <a href="#" class="hover:text-yellow-400" onclick="showSection('missions')">Missions</a>
            </div>
            <button class="md:hidden" onclick="toggleMobileMenu()">‚ò∞</button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-gray-900 bg-opacity-80 px-4 py-2">
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('welcome')">Home</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('profile')">Profile</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('kindergarten')">Quiz</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('year1')">Memory Game</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('year2')">Wudhu Puzzle</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('year3')">Karbala Quest</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('year4')">Art Zone</a>
            <a href="#" class="block py-1 hover:text-yellow-400" onclick="showSection('missions')">Missions</a>
        </div>
    </nav>
    <div class="star-counter" id="star-counter">Stars: <span id="star-count">0</span> ‚≠ê</div>
    <img id="avatar-display" src="" alt="Your Avatar" class="avatar-display" style="display: none;">

    <!-- Intro Screen -->
    <div id="intro" class="section active container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Welcome, Young Scholar!</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/welcome_islamic.jpg" alt="Islamic Welcome" class="karbala-img">
            </div>
            <div class="space-y-4">
                <p class="text-lg">Enter your name:</p>
                <input type="text" id="name-input" class="input-field border-2 border-blue-500 rounded-lg p-2 w-full max-w-xs" placeholder="Your Name">
                <p class="text-lg">Are you a boy or a girl?</p>
                <div class="flex justify-center gap-4">
                    <label class="flex items-center"><input type="radio" name="gender" value="boy" class="mr-2" checked> Boy</label>
                    <label class="flex items-center"><input type="radio" name="gender" value="girl" class="mr-2"> Girl</label>
                </div>
                <p class="text-lg">Which year are you in?</p>
                <select id="year-select" class="input-field border-2 border-blue-500 rounded-lg p-2 w-full max-w-xs">
                    <option value="kindergarten">Kindergarten</option>
                    <option value="year1">Year 1</option>
                    <option value="year2">Year 2</option>
                    <option value="year3">Year 3</option>
                    <option value="year4">Year 4</option>
                    <option value="year5">Year 5</option>
                    <option value="year6">Year 6</option>
                    <option value="year7">Year 7</option>
                </select>
                <p class="text-lg">Choose your character:</p>
                <div class="character-container">
                    <img src="https://yourusername.github.io/your-repo/images/boy1.jpg" alt="Boy 1" class="character" data-gender="boy">
                    <img src="https://yourusername.github.io/your-repo/images/boy2.jpg" alt="Boy 2" class="character" data-gender="boy">
                    <img src="https://yourusername.github.io/your-repo/images/girl1_hijab.jpg" alt="Girl 1 in Hijab" class="character" data-gender="girl">
                    <img src="https://yourusername.github.io/your-repo/images/girl2_hijab.jpg" alt="Girl 2 in Hijab" class="character" data-gender="girl">
                </div>
                <button class="btn" onclick="startLearning()">Start Learning!</button>
            </div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6" id="welcome-title">Welcome, Young Scholar!</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/welcome_islamic.jpg" alt="Islamic Welcome" class="karbala-img">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button class="btn" onclick="showSection('profile')">View Profile</button>
                <button class="btn" onclick="showSection('kindergarten')">Play Quiz</button>
                <button class="btn" onclick="showSection('year1')">Memory Game</button>
                <button class="btn" onclick="showSection('year2')">Wudhu Puzzle</button>
                <button class="btn" onclick="showSection('year3')">Karbala Quest</button>
                <button class="btn" onclick="showSection('year4')">Islamic Art Zone</button>
                <button class="btn" onclick="showSection('missions')">Daily Missions</button>
            </div>
        </div>
    </div>

    <!-- Profile Screen -->
    <div id="profile" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Your Profile</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/profile_islamic.jpg" alt="Profile Islamic" class="karbala-img">
            </div>
            <div class="profile-info text-lg" id="profile-info"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Kindergarten Quiz -->
    <div id="kindergarten" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6" id="kinder-title">Kindergarten Quiz: Islamic Basics</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/allah_symbol.jpg" alt="Islamic Symbol" class="karbala-img">
            </div>
            <div id="quiz-container" class="space-y-4"></div>
            <div id="score" class="text-lg"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Year 1: Memory Game -->
    <div id="year1" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 1: Imam Memory Game</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/memory_imam.jpg" alt="Imam Symbol" class="karbala-img">
            </div>
            <div id="memory-board" class="grid grid-cols-4 gap-3 justify-center"></div>
            <div id="memory-result" class="text-lg mt-4"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Year 2: Wudhu Puzzle -->
    <div id="year2" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 2: Wudhu Puzzle</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/wudhu_scene.jpg" alt="Wudhu Scene" class="karbala-img">
            </div>
            <div class="wudhu-instruction text-lg mb-4">Drag the Wudhu steps to sort them in order, then categorize as Obligatory or Mustahab:</div>
            <div id="wudhu-area">
                <div id="wudhu-board" class="grid grid-cols-4 gap-3 justify-center mb-4"></div>
                <div class="wudhu-container">
                    <div class="wudhu-obligatory" id="obligatory-area">
                        <h3 class="text-xl font-semibold">Obligatory</h3>
                    </div>
                    <div class="wudhu-mustahab" id="mustahab-area">
                        <h3 class="text-xl font-semibold">Mustahab</h3>
                    </div>
                </div>
            </div>
            <button class="btn mt-4" onclick="checkWudhu()">Check Order & Categories</button>
            <div id="wudhu-result" class="text-lg mt-4"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Year 3: Imam Hussain Story Mode -->
    <div id="year3" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 3: Karbala Quest</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/karbala_quest.jpg" alt="Karbala Quest" class="karbala-img">
            </div>
            <div class="story-text text-lg mb-4" id="story-text">You are at Karbala with Imam Hussain (AS). The enemy offers you safety if you abandon him. What do you do?</div>
            <button class="btn story-option" onclick="makeChoice('stay')">Stay with Imam Hussain</button>
            <button class="btn story-option" onclick="makeChoice('leave')">Leave for safety</button>
            <div id="story-result" class="text-lg mt-4"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Year 4: Islamic Art Zone -->
    <div id="year4" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 4: Islamic Art Zone</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/art_zone.jpg" alt="Art Zone" class="karbala-img">
            </div>
            <p class="text-lg mb-4">Choose an image to color:</p>
            <div class="character-container">
                <img src="https://yourusername.github.io/your-repo/images/kaaba_lineart.jpg" alt="Kaaba" class="art-image" onclick="selectArtImage('kaaba_lineart.jpg')">
                <img src="https://yourusername.github.io/your-repo/images/nabawi_lineart.jpg" alt="Masjid al-Nabawi" class="art-image" onclick="selectArtImage('nabawi_lineart.jpg')">
                <img src="https://yourusername.github.io/your-repo/images/kufa_lineart.jpg" alt="Masjid al-Kufa" class="art-image" onclick="selectArtImage('kufa_lineart.jpg')">
                <img src="https://yourusername.github.io/your-repo/images/ali_shrine_lineart.jpg" alt="Imam Ali Shrine" class="art-image" onclick="selectArtImage('ali_shrine_lineart.jpg')">
            </div>
            <div class="art-tools">
                <input type="color" id="color-picker" class="h-10 w-10" value="#facc15">
                <select id="brush-size" class="border-2 border-blue-500 rounded-lg p-2">
                    <option value="5">Small</option>
                    <option value="10" selected>Medium</option>
                    <option value="20">Large</option>
                </select>
                <button class="btn" onclick="undoStroke()">Undo</button>
                <button class="btn" onclick="clearCanvas()">Clear Canvas</button>
                <button class="btn" onclick="saveArtwork()">Save Artwork</button>
            </div>
            <canvas id="art-canvas" width="400" height="400"></canvas>
            <div id="art-result" class="text-lg mt-4"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Daily Missions -->
    <div id="missions" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Daily Missions</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/mission_hadith.jpg" alt="Hadith Book" class="karbala-img">
            </div>
            <div id="mission-container" class="space-y-4"></div>
            <div id="mission-result" class="text-lg mt-4"></div>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- Placeholder Sections for Other Years -->
    <div id="year5" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 5: Coming Soon!</h1>
            <p class="text-lg">More games will be added for Year 5.</p>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>
    <div id="year6" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 6: Coming Soon!</h1>
            <p class="text-lg">More games will be added for Year 6.</p>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>
    <div id="year7" class="section container">
        <div class="card">
            <h1 class="text-3xl font-semibold text-pink-600 mb-6">Year 7: Coming Soon!</h1>
            <div class="flex justify-center mb-6">
                <img src="https://yourusername.github.io/your-repo/images/imam_hussain_dua.jpg" alt="Imam Hussain Dua" class="karbala-img">
            </div>
            <p class="text-lg">More games will be added for Year 7.</p>
            <button class="btn mt-4" onclick="showSection('welcome')">Back to Home</button>
        </div>
    </div>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <!-- Confetti.js -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Howler.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script>
        let userData = { name: '', gender: 'boy', year: 'kindergarten', character: '', stars: 0, missions: {}, artwork: {} };
        let currentQuestion = 0;
        let score = 0;
        let strokeHistory = [];
        const questions = [
            { question: 'What is the name of our Creator?', type: 'text', answer: 'Allah' },
            { question: 'Who is the final Messenger of Allah (SWT)?', type: 'multiple', options: ['Prophet Musa', 'Prophet Muhammad', 'Prophet Isa'], answer: 'Prophet Muhammad' },
            { question: 'Who is the first Imam (AS)?', type: 'multiple', options: ['Imam Ali', 'Imam Hassan', 'Imam Hussain'], answer: 'Imam Ali' },
            { question: 'What is the name of the daughter of Prophet Muhammad (S)?', type: 'multiple', options: ['Aisha', 'Khadija', 'Fatima'], answer: 'Fatima' },
            { question: 'What is the name of our religion?', type: 'multiple', options: ['Christianity', 'Islam', 'Hinduism'], answer: 'Islam' }
        ];
        const missions = [
            { id: 'hadith', title: 'Learn a New Hadith', question: 'What does this hadith mean: "The best of you are those who are best to their families"?', type: 'multiple', options: ['Be kind to your family', 'Study hard', 'Pray alone'], answer: 'Be kind to your family' },
            { id: 'zaynab', title: 'Help Zaynab Find the Prayer Direction', question: 'Which direction should Zaynab face to pray?', type: 'multiple', options: ['North', 'Qibla', 'West'], answer: 'Qibla' }
        ];
        const memoryCards = [
            { name: 'Imam Ali', match: 'First Imam', id: 1 },
            { name: 'First Imam', match: 'Imam Ali', id: 2 },
            { name: 'Imam Hussain', match: 'Karbala', id: 3 },
            { name: 'Karbala', match: 'Imam Hussain', id: 4 },
            { name: 'Imam Hassan', match: 'Second Imam', id: 5 },
            { name: 'Second Imam', match: 'Imam Hassan', id: 6 },
            { name: 'Prophet Muhammad', match: 'Final Messenger', id: 7 },
            { name: 'Final Messenger', match: 'Prophet Muhammad', id: 8 }
        ];
        const wudhuSteps = [
            { name: 'Rinse mouth', id: 1, category: 'mustahab' },
            { name: 'Rinse nose', id: 2, category: 'mustahab' },
            { name: 'Wash hands', id: 3, category: 'mustahab' },
            { name: 'Wash face', id: 4, category: 'obligatory' },
            { name: 'Wash right arm', id: 5, category: 'obligatory' },
            { name: 'Wash left arm', id: 6, category: 'obligatory' },
            { name: 'Wipe the head', id: 7, category: 'obligatory' },
            { name: 'Wipe the right foot', id: 8, category: 'obligatory' },
            { name: 'Wipe the left foot', id: 9, category: 'obligatory' }
        ];
        let flippedCards = [];
        let matchedCards = [];
        let dragged;
        let currentArtImage = '';
        const sounds = {
            correct: new Howl({ src: ['https://yourusername.github.io/your-repo/sounds/success.mp3'] }),
            incorrect: new Howl({ src: ['https://yourusername.github.io/your-repo/sounds/error.mp3'] }),
            star: new Howl({ src: ['https://yourusername.github.io/your-repo/sounds/star.mp3'] })
        };

        // Load User Data
        function loadUserData() {
            const savedData = localStorage.getItem('userData');
            if (savedData) {
                userData = JSON.parse(savedData);
                document.getElementById('welcome-title').innerHTML = `Welcome Back, ${userData.name}!`;
                showSection('welcome');
                document.getElementById('avatar-display').src = userData.character;
                document.getElementById('avatar-display').style.display = 'block';
                updateStarCounter();
                loadArtwork();
                gsap.from('.card', { opacity: 0, y: 50, duration: 0.5, ease: 'power2.out' });
            } else {
                showSection('intro'); // Ensure intro is shown for new users
            }
        }

        // Save User Data
        function saveUserData() {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        // Character Selection
        document.querySelectorAll('.character').forEach(img => {
            img.addEventListener('click', () => {
                document.querySelectorAll('.character').forEach(i => i.classList.remove('selected'));
                img.classList.add('selected');
                userData.character = img.src;
                document.getElementById('avatar-display').src = userData.character;
                document.getElementById('avatar-display').style.display = 'block';
                saveUserData();
                gsap.to(img, { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
            });
        });

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            const section = document.getElementById(sectionId);
            section.classList.add('active');
            gsap.from(section.querySelector('.card'), { opacity: 0, y: 50, duration: 0.5, ease: 'power2.out' });
            if (sectionId === 'kindergarten') {
                document.getElementById('kinder-title').innerHTML = `Kindergarten Quiz: Islamic Basics, ${userData.name}!`;
                currentQuestion = 0;
                score = 0;
                showQuestion();
                document.getElementById('score').innerHTML = '';
            }
            if (sectionId === 'year1') {
                flippedCards = [];
                matchedCards = [];
                createMemoryBoard();
                document.getElementById('memory-result').innerHTML = '';
            }
            if (sectionId === 'year2') {
                createWudhuBoard();
                document.getElementById('wudhu-result').innerHTML = '';
            }
            if (sectionId === 'year3') {
                document.getElementById('story-text').innerHTML = 'You are at Karbala with Imam Hussain (AS). The enemy offers you safety if you abandon him. What do you do?';
                document.getElementById('story-result').innerHTML = '';
                document.querySelectorAll('.story-option').forEach(btn => btn.style.display = 'inline-block');
            }
            if (sectionId === 'year4') {
                currentArtImage = '';
                strokeHistory = [];
                clearCanvas();
                document.getElementById('art-result').innerHTML = userData.artwork[currentArtImage] ? 'Your artwork is saved!' : '';
            }
            if (sectionId === 'missions') {
                showMission();
            }
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        // Start Learning
        function startLearning() {
            userData.name = document.getElementById('name-input').value || 'Young Scholar';
            userData.gender = document.querySelector('input[name="gender"]:checked').value;
            userData.year = document.getElementById('year-select').value;
            if (!userData.character) {
                userData.character = document.querySelector('.character').src;
            }
            document.getElementById('avatar-display').src = userData.character;
            document.getElementById('avatar-display').style.display = 'block';
            saveUserData();
            showSection('welcome');
            document.getElementById('welcome-title').innerHTML = `Welcome Back, ${userData.name}!`;
        }

        // Profile Screen
        function showProfile() {
            showSection('profile');
            const profileInfo = document.getElementById('profile-info');
            let artworkHtml = '';
            for (let img in userData.artwork) {
                artworkHtml += `<p>Saved Artwork: <img src="${userData.artwork[img]}" alt="${img}" width="100" class="rounded-lg"></p>`;
            }
            profileInfo.innerHTML = `
                Name: ${userData.name}<br>
                Gender: ${userData.gender === 'boy' ? 'Boy' : 'Girl in Hijab'}<br>
                Year: ${userData.year.replace('year', 'Year ').replace('kindergarten', 'Kindergarten')}<br>
                Stars: ${userData.stars} ‚≠ê<br>
                Missions Completed: ${Object.keys(userData.missions).length > 0 ? Object.keys(userData.missions).join(', ') : 'None'}<br>
                ${artworkHtml}
            `;
            gsap.from('.profile-info', { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        // Kindergarten Quiz
        function showQuestion() {
            const container = document.getElementById('quiz-container');
            const q = questions[currentQuestion];
            let html = `<div class="question text-lg text-blue-600">${q.question}</div>`;
            if (q.type === 'text') {
                html += `<input type="text" id="answer-input" class="input-field border-2 border-blue-500 rounded-lg p-2 w-full max-w-xs" placeholder="Type your answer">`;
                html += `<button class="btn mt-2" onclick="checkAnswer()">Submit</button>`;
            } else {
                q.options.forEach(opt => {
                    html += `<button class="btn option mt-2" onclick="checkAnswer('${opt}')">${opt}</button>`;
                });
            }
            container.innerHTML = html;
            gsap.from(container.children, { opacity: 0, y: 20, stagger: 0.1, duration: 0.5, ease: 'power2.out' });
        }

        function checkAnswer(answer) {
            const q = questions[currentQuestion];
            const result = document.getElementById('score');
            if (q.type === 'text') {
                answer = document.getElementById('answer-input').value.trim();
            }
            if (answer.toLowerCase() === q.answer.toLowerCase()) {
                score++;
                result.innerHTML = `Correct! Score: ${score}/${questions.length}`;
                result.style.color = '#10b981';
                sounds.correct.play();
                gsap.to(result, { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
            } else {
                result.innerHTML = `Incorrect. The answer is ${q.answer}. Score: ${score}/${questions.length}`;
                result.style.color = '#ef4444';
                sounds.incorrect.play();
                gsap.to(result, { x: [-10, 10, 0], duration: 0.3, ease: 'power2.out' });
            }
            currentQuestion++;
            if (currentQuestion < questions.length) {
                showQuestion();
            } else {
                showFinalScore();
            }
        }

        function showFinalScore() {
            const container = document.getElementById('quiz-container');
            const result = document.getElementById('score');
            container.innerHTML = '';
            result.innerHTML = `Quiz Complete, ${userData.name}! Final Score: ${score}/${questions.length}`;
            if (score >= 4) {
                userData.stars++;
                result.innerHTML += `<br>Congratulations! You earned a <span class="star text-yellow-400">‚≠ê</span> Gold Star!`;
                sounds.star.play();
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                saveUserData();
                updateStarCounter();
            } else {
                result.innerHTML += `<br>Try again to earn a Gold Star!`;
            }
            gsap.from(result, { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        // Memory Game (Year 1)
        function createMemoryBoard() {
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            memoryCards.sort(() => Math.random() - 0.5);
            memoryCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('memory-card');
                cardElement.dataset.name = card.name;
                cardElement.dataset.match = card.match;
                cardElement.dataset.id = card.id;
                cardElement.innerHTML = '‚≠ê';
                cardElement.onclick = () => flipCard(cardElement);
                board.appendChild(cardElement);
                gsap.from(cardElement, { opacity: 0, scale: 0.8, duration: 0.5, ease: 'power2.out' });
            });
        }

        function flipCard(card) {
            if (flippedCards.length < 2 && !flippedCards.includes(card) && !matchedCards.includes(card.dataset.id)) {
                card.innerHTML = card.dataset.name;
                flippedCards.push(card);
                gsap.to(card, { rotationY: 180, duration: 0.5, ease: 'power2.out' });
                if (flippedCards.length === 2) {
                    setTimeout(checkMatch, 1000);
                }
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            const result = document.getElementById('memory-result');
            if (card1.dataset.name === card2.dataset.match || card2.dataset.name === card1.dataset.match) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedCards.push(card1.dataset.id, card2.dataset.id);
                result.innerHTML = 'Match found! Great job! üéâ';
                result.style.color = '#10b981';
                sounds.correct.play();
                gsap.to([card1, card2], { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
                if (matchedCards.length === memoryCards.length) {
                    userData.stars++;
                    result.innerHTML = `You won the game! Earned a <span class="star text-yellow-400">‚≠ê</span> Gold Star!`;
                    sounds.star.play();
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    saveUserData();
                    updateStarCounter();
                }
            } else {
                card1.innerHTML = '‚≠ê';
                card2.innerHTML = '‚≠ê';
                result.innerHTML = 'No match. Try again!';
                result.style.color = '#ef4444';
                sounds.incorrect.play();
                gsap.to([card1, card2], { rotationY: 0, duration: 0.5, ease: 'power2.out' });
            }
            flippedCards = [];
            gsap.from(result, { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        // Wudhu Puzzle (Year 2)
        function createWudhuBoard() {
            const board = document.getElementById('wudhu-board');
            const obligatoryArea = document.getElementById('obligatory-area');
            const mustahabArea = document.getElementById('mustahab-area');
            board.innerHTML = '';
            obligatoryArea.innerHTML = '<h3 class="text-xl font-semibold">Obligatory</h3>';
            mustahabArea.innerHTML = '<h3 class="text-xl font-semibold">Mustahab</h3>';
            wudhuSteps.sort(() => Math.random() - 0.5);
            wudhuSteps.forEach(step => {
                const stepElement = document.createElement('div');
                stepElement.classList.add('wudhu-step');
                stepElement.dataset.id = step.id;
                stepElement.dataset.category = step.category;
                stepElement.innerHTML = step.name;
                stepElement.draggable = true;
                stepElement.ondragstart = drag;
                board.appendChild(stepElement);
                gsap.from(stepElement, { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
            });
        }

        function drag(event) {
            dragged = event.target;
            gsap.to(dragged, { scale: 1.1, duration: 0.2, ease: 'power2.out' });
        }

        ['wudhu-board', 'obligatory-area', 'mustahab-area'].forEach(id => {
            const area = document.getElementById(id);
            area.addEventListener('dragover', (e) => e.preventDefault());
            area.addEventListener('drop', (e) => {
                e.preventDefault();
                const target = e.target.closest('.wudhu-step');
                if (target) {
                    target.parentNode.insertBefore(dragged, target.nextSibling);
                } else {
                    e.target.appendChild(dragged);
                }
                gsap.to(dragged, { scale: 1, duration: 0.2, ease: 'power2.out' });
            });
        });

        function checkWudhu() {
            const obligatorySteps = document.querySelectorAll('#obligatory-area .wudhu-step');
            const mustahabSteps = document.querySelectorAll('#mustahab-area .wudhu-step');
            const obligatoryOrder = ['4', '5', '6', '7', '8', '9'];
            const mustahabOrder = ['1', '2', '3'];
            let isOrderCorrect = true;
            let isCategoryCorrect = true;

            obligatorySteps.forEach((step, index) => {
                if (step.dataset.id !== obligatoryOrder[index]) {
                    isOrderCorrect = false;
                }
                if (step.dataset.category !== 'obligatory') {
                    isCategoryCorrect = false;
                }
            });

            mustahabSteps.forEach((step, index) => {
                if (step.dataset.id !== mustahabOrder[index]) {
                    isOrderCorrect = false;
                }
                if (step.dataset.category !== 'mustahab') {
                    isCategoryCorrect = false;
                }
            });

            const result = document.getElementById('wudhu-result');
            if (isOrderCorrect && isCategoryCorrect && obligatorySteps.length === 6 && mustahabSteps.length === 3) {
                userData.stars++;
                result.innerHTML = `Correct! You sorted and categorized the Wudhu steps! Earned a <span class="star text-yellow-400">‚≠ê</span> Gold Star!`;
                result.style.color = '#10b981';
                sounds.star.play();
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                obligatorySteps.forEach(step => {
                    step.classList.add('correct');
                    gsap.to(step, { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
                });
                mustahabSteps.forEach(step => {
                    step.classList.add('correct');
                    gsap.to(step, { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
                });
                saveUserData();
                updateStarCounter();
            } else {
                result.innerHTML = 'Incorrect. Try again! Hint: Obligatory steps start with face, end with feet; Mustahab starts with mouth, ends with hands.';
                result.style.color = '#ef4444';
                sounds.incorrect.play();
                gsap.to(obligatorySteps, { x: [-10, 10, 0], duration: 0.3, ease: 'power2.out' });
                gsap.to(mustahabSteps, { x: [-10, 10, 0], duration: 0.3, ease: 'power2.out' });
            }
            gsap.from(result, { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        // Imam Hussain Story Mode (Year 3)
        function makeChoice(choice) {
            const result = document.getElementById('story-result');
            if (choice === 'stay') {
                userData.stars++;
                result.innerHTML = `You chose courage! Imam Hussain (AS) is proud! Earned a <span class="star text-yellow-400">‚≠ê</span> Gold Star!`;
                result.style.color = '#10b981';
                sounds.star.play();
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                document.querySelectorAll('.story-option').forEach(btn => btn.style.display = 'none');
                saveUserData();
                updateStarCounter();
            } else {
                result.innerHTML = 'Reflect and try again. Loyalty is key in Karbala.';
                result.style.color = '#ef4444';
                sounds.incorrect.play();
            }
            gsap.from(result, { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        // Islamic Art Zone (Year 4)
        const canvas = document.getElementById('art-canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        function selectArtImage(image) {
            currentArtImage = `https://yourusername.github.io/your-repo/images/${image}`;
            document.querySelectorAll('.art-image').forEach(img => img.classList.remove('selected'));
            document.querySelector(`img[src="https://yourusername.github.io/your-repo/images/${image}"]`).classList.add('selected');
            const img = new Image();
            img.src = currentArtImage;
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                strokeHistory = [];
                if (userData.artwork[image]) {
                    const savedImg = new Image();
                    savedImg.src = userData.artwork[image];
                    savedImg.onload = () => ctx.drawImage(savedImg, 0, 0, canvas.width, canvas.height);
                }
            };
            document.getElementById('art-result').innerHTML = userData.artwork[image] ? 'Your artwork is saved!' : '';
            gsap.to(`.art-image[src="https://yourusername.github.io/your-repo/images/${image}"]`, { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
        }

        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            strokeHistory.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            draw(e);
        });

        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseout', () => isDrawing = false);

        function draw(e) {
            if (!isDrawing || !currentArtImage) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.beginPath();
            ctx.arc(x, y, document.getElementById('brush-size').value / 2, 0, Math.PI * 2);
            ctx.fillStyle = document.getElementById('color-picker').value;
            ctx.fill();
            sounds.correct.play();
            gsap.to(canvas, { scale: 1.02, duration: 0.2, ease: 'power2.out', yoyo: true, repeat: 1 });
        }

        function undoStroke() {
            if (strokeHistory.length > 0) {
                ctx.putImageData(strokeHistory.pop(), 0, 0);
            } else {
                clearCanvas();
            }
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (currentArtImage) {
                const img = new Image();
                img.src = currentArtImage;
                img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            }
            strokeHistory = [];
            document.getElementById('art-result').innerHTML = '';
        }

        function saveArtwork() {
            if (!currentArtImage) {
                document.getElementById('art-result').innerHTML = 'Please select an image to color!';
                return;
            }
            userData.artwork[currentArtImage.split('/').pop()] = canvas.toDataURL();
            saveUserData();
            document.getElementById('art-result').innerHTML = 'Artwork saved! Check your profile!';
            gsap.from('#art-result', { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        function loadArtwork() {
            if (currentArtImage && userData.artwork[currentArtImage.split('/').pop()]) {
                const img = new Image();
                img.src = userData.artwork[currentArtImage.split('/').pop()];
                img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            }
        }

        // Daily Missions
        function showMission() {
            const today = new Date().toISOString().split('T')[0];
            if (userData.missions[today]) {
                document.getElementById('mission-container').innerHTML = 'You completed today‚Äôs mission!';
                document.getElementById('mission-result').innerHTML = '';
                return;
            }
            const mission = missions[new Date().getDay() % missions.length];
            const container = document.getElementById('mission-container');
            let html = `<div class="mission-text text-lg text-blue-600">${mission.title}: ${mission.question}</div>`;
            mission.options.forEach(opt => {
                html += `<button class="btn mission-button mt-2" onclick="checkMission('${opt}', '${mission.id}')">${opt}</button>`;
            });
            container.innerHTML = html;
            gsap.from(container.children, { opacity: 0, y: 20, stagger: 0.1, duration: 0.5, ease: 'power2.out' });
        }

        function checkMission(answer, missionId) {
            const mission = missions.find(m => m.id === missionId);
            const result = document.getElementById('mission-result');
            const today = new Date().toISOString().split('T')[0];
            if (answer === mission.answer) {
                userData.stars++;
                userData.missions[today] = mission.id;
                result.innerHTML = `Correct! You earned a <span class="star text-yellow-400">‚≠ê</span> Gold Star!`;
                result.style.color = '#10b981';
                sounds.star.play();
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                saveUserData();
                updateStarCounter();
                document.getElementById('mission-container').innerHTML = 'Mission complete! Come back tomorrow!';
            } else {
                result.innerHTML = `Incorrect. Try again!`;
                result.style.color = '#ef4444';
                sounds.incorrect.play();
            }
            gsap.from(result, { opacity: 0, y: 20, duration: 0.5, ease: 'power2.out' });
        }

        function updateStarCounter() {
            const starCount = document.getElementById('star-count');
            starCount.innerText = userData.stars;
            gsap.to(starCount, { scale: 1.2, duration: 0.3, ease: 'power2.out', yoyo: true, repeat: 1 });
        }

        // Initialize
        loadUserData();
    </script>
</body>
</html>
