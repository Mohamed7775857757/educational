<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shia Islamic Adventure Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
    <script type="module">
        // Import Firebase
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBD2asTEG40b4hhVmUZKlGd3ZPe-NJctxM",
            authDomain: "shia-kids-learning-tool.firebaseapp.com",
            projectId: "shia-kids-learning-tool",
            storageBucket: "shia-kids-learning-tool.appspot.com",
            messagingSenderId: "786313108719",
            appId: "1:786313108719:web:5d4d9ced7abd14b9d18f1a"
        };

        const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
        const auth = getAuth(app);

        let userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
        let currentQuestion = 0;
        let score = 0;
        let flippedCards = [];
        let matchedCards = [];
        let lock = false;

        const questions = {
            'Level-1': [
                { question: 'Who is the Creator?', options: ['Allah', 'Adam', 'Noah'], answer: 'Allah' },
                { question: 'What is the holy book?', options: ['Bible', 'Quran', 'Torah'], answer: 'Quran' }
            ],
            'Level-2': [
                { question: 'Who was the first Imam?', options: ['Imam Ali', 'Imam Hassan', 'Imam Hussain'], answer: 'Imam Ali' }
            ],
            'Level-3': [
                { question: 'What is the first step of Wudhu?', options: ['Niyyah', 'Wash Face', 'Wash Hands'], answer: 'Niyyah' }
            ],
            'Level-4': [
                { question: 'Where did the Battle of Karbala occur?', options: ['Mecca', 'Karbala', 'Medina'], answer: 'Karbala' }
            ],
            'Level-5': [
                { question: 'What is Islamic art often based on?', options: ['Animals', 'Geometry', 'Portraits'], answer: 'Geometry' }
            ],
            'Level-6': [
                { question: 'What is the purpose of Hajj?', options: ['Prayer', 'Pilgrimage', 'Fasting'], answer: 'Pilgrimage' }
            ],
            'Level-7': [
                { question: 'What is the name of the Prophet’s daughter?', options: ['Fatima', 'Aisha', 'Khadija'], answer: 'Fatima' }
            ],
            'Level-8': [
                { question: 'Who was the second Imam?', options: ['Imam Hassan', 'Imam Hussain', 'Imam Ali'], answer: 'Imam Hassan' }
            ],
            'Level-9': [
                { question: 'What is the significance of Ashura?', options: ['Victory', 'Martyrdom', 'Birth'], answer: 'Martyrdom' }
            ],
            'Level-10': [
                { question: 'Who is the current Imam according to Shia belief?', options: ['Imam Mahdi', 'Imam Ali', 'Imam Hassan'], answer: 'Imam Mahdi' }
            ]
        };

        const memoryCards = [
            { name: 'Prophet Muhammad(s)', match: 'Prophet Muhammad(s)', id: 1 },
            { name: 'Prophet Muhammad(s)', match: 'Prophet Muhammad(s)', id: 2 },
            { name: 'Imam Ali(as)', match: 'Imam Ali(as)', id: 3 },
            { name: 'Imam Ali(as)', match: 'Imam Ali(as)', id: 4 }
        ];

        const wudhuSteps = [
            { name: 'Niyyah', id: 1, category: 'obligatory', order: 1 },
            { name: 'Wash Face', id: 2, category: 'obligatory', order: 2 },
            { name: 'Wash Right Arm', id: 3, category: 'obligatory', order: 3 },
            { name: 'Wash Left Arm', id: 4, category: 'obligatory', order: 4 }
        ];

        const storyData = {
            mecca: {
                start: { text: "You are in Mecca. What do you do?", choices: { a: { text: "Pray", next: "pray" }, b: { text: "Explore", next: "explore" } }, background: "https://via.placeholder.com/1920x1080?text=Mecca", animation: "happy" },
                pray: { text: "You prayed. Journey ends.", choices: { a: { text: "Restart", next: "start" } }, background: "https://via.placeholder.com/1920x1080?text=Pray", animation: "happy" },
                explore: { text: "You explored. Journey ends.", choices: { a: { text: "Restart", next: "start" } }, background: "https://via.placeholder.com/1920x1080?text=Explore", animation: "happy" }
            }
        };

        const missions = [
            { id: 'salah', title: 'Daily Salah', question: 'How many daily prayers?', type: 'text', answer: '5' },
            { id: 'dua', title: 'Daily Dua', question: 'What is a common dua?', type: 'text', answer: 'Bismillah' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const landingPage = document.getElementById('landing-page');
            const welcomeSection = document.getElementById('welcome');
            if (landingPage) landingPage.style.display = 'block';
            if (welcomeSection) welcomeSection.classList.add('hidden');

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userData.email = user.email;
                    loadUserData();
                    document.getElementById('login-modal').style.display = 'none';
                    document.getElementById('landing-page').style.display = 'none';
                    document.getElementById('welcome').classList.remove('hidden');
                    showSection('welcome');
                } else {
                    userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
                    localStorage.removeItem('userData');
                    if (landingPage) landingPage.style.display = 'block';
                    if (welcomeSection) welcomeSection.classList.add('hidden');
                }
            });

            window.showLoginModal = () => { document.getElementById('login-modal').style.display = 'flex'; };
            window.showSignupModal = () => { document.getElementById('signup-modal').style.display = 'flex'; };
            window.showAdminLoginModal = () => { document.getElementById('admin-login-modal').style.display = 'flex'; };

            window.showSection = function(sectionId) {
                document.querySelectorAll('.section, #landing-page, #hero').forEach(el => el.classList.add('hidden'));
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('hidden');
                    gsap.from(`#${sectionId.replace(/ /g, '-')}`, { opacity: 0, y: 50, duration: 0.5 });
                    if (sectionId === 'Level-1') showQuiz();
                    if (sectionId === 'Level-2') initMemoryGame();
                    if (sectionId === 'Level-3') initWudhuChallenge();
                    if (sectionId === 'Level-4') showKarbala();
                    if (sectionId === 'Level-5') initArtZone();
                    if (sectionId === 'Level-6') showHajj();
                    if (sectionId === 'Level-7') startStory();
                    if (sectionId === 'missions') showMissions();
                    if (sectionId === 'profile') showProfile();
                    updateProgress();
                }
            };

            window.checkAnswer = function(selected) {
                const q = questions[userData.year][currentQuestion];
                if (selected.toLowerCase() === q.answer.toLowerCase()) {
                    score++;
                    userData.stars += 2;
                    updateStarCounter();
                    confetti();
                    document.getElementById('score').innerHTML = '<p class="text-green-600">Correct! 🎉</p>';
                } else document.getElementById('score').innerHTML = '<p class="text-red-600">Wrong! 😕</p>';
                currentQuestion++;
                if (currentQuestion < questions[userData.year].length) setTimeout(showNextQuestion, 1000);
                else {
                    userData.progress += score;
                    updateProgress();
                    alert(`Quiz complete! Score: ${score}/${questions[userData.year].length}`);
                    showSection('welcome');
                }
            };

            window.login = () => {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                signInWithEmailAndPassword(auth, email, password)
                    .then(() => {
                        alert('Login successful!');
                        userData.email = email;
                        loadUserData();
                        closeModal({ target: { className: 'modal' } });
                        showSection('welcome');
                    })
                    .catch(error => alert('Error: ' + error.message));
            };

            window.signupUser = () => {
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const name = document.getElementById('signup-name').value;
                const gender = document.querySelector('input[name="gender"]:checked').value;
                const year = document.getElementById('year-select').value;
                const character = document.querySelector('.character.selected') ? document.querySelector('.character.selected').getAttribute('src') : '';
                createUserWithEmailAndPassword(auth, email, password)
                    .then(() => {
                        userData = { ...userData, name, gender, year, character, email };
                        alert('Sign-up successful!');
                        saveUserData();
                        closeModal({ target: { className: 'modal' } });
                        showSection('welcome');
                    })
                    .catch(error => alert('Error: ' + error.message));
            };

            window.resetPassword = () => {
                const email = document.getElementById('reset-email').value;
                sendPasswordResetEmail(auth, email)
                    .then(() => alert('Password reset email sent!'))
                    .catch(error => alert('Error: ' + error.message));
            };

            window.logout = () => {
                signOut(auth).then(() => {
                    alert('Logged out successfully!');
                    userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
                    localStorage.removeItem('userData');
                    document.getElementById('landing-page').style.display = 'block';
                    document.getElementById('welcome').classList.add('hidden');
                }).catch(error => alert('Error: ' + error.message));
            };

            window.loginAdmin = () => {
                const email = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                if (email === 'melzein1987@gmail.com' && password === 'admin123') {
                    alert('Admin login successful!');
                    closeModal({ target: { className: 'modal' } });
                    // Add admin dashboard logic here if needed
                } else {
                    alert('Invalid admin credentials!');
                }
            };

            function loadUserData() {
                const saved = localStorage.getItem('userData');
                if (saved) {
                    userData = JSON.parse(saved);
                    if (userData.character) document.getElementById('avatar-display').src = userData.character;
                    if (userData.character) document.getElementById('avatar-display').style.display = 'block';
                }
                document.getElementById('welcome-name').textContent = userData.name || 'Young Explorer';
                updateStarCounter();
                updateProgress();
                updateBadges();
            }

            function saveUserData() { localStorage.setItem('userData', JSON.stringify(userData)); }
            window.closeModal = (event) => { if (event.target.classList.contains('modal')) document.getElementById(event.target.id).style.display = 'none'; };

            document.querySelectorAll('.character').forEach(char => {
                char.addEventListener('click', () => {
                    document.querySelectorAll('.character').forEach(c => c.classList.remove('selected'));
                    char.classList.add('selected');
                    userData.character = char.getAttribute('src');
                });
            });

            function showQuiz() {
                currentQuestion = 0;
                score = 0;
                const container = document.getElementById('Level-1');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Quiz Challenge 📖</h2>
                    <div id="quiz-container"></div>
                    <div id="score" class="text-xl mb-4"></div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
                showNextQuestion();
            }

            function showNextQuestion() {
                const q = questions[userData.year][currentQuestion];
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.innerHTML = `<p>${q.question}</p>${q.options.map(opt => `<button class="btn mt-2" onclick="checkAnswer('${opt}')">${opt}</button>`).join('')}`;
            }

            function initMemoryGame() {
                const container = document.getElementById('Level-2');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Memory Quest 🧠</h2>
                    <div id="memory-game" class="grid grid-cols-4 gap-4"></div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
                const gameContainer = document.getElementById('memory-game');
                const shuffledCards = [...memoryCards].sort(() => Math.random() - 0.5);
                gameContainer.innerHTML = '';
                shuffledCards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'memory-card';
                    cardElement.dataset.name = card.name;
                    cardElement.textContent = '❓';
                    cardElement.addEventListener('click', () => flipCard(cardElement));
                    gameContainer.appendChild(cardElement);
                });
            }

            function flipCard(card) {
                if (lock || flippedCards.length >= 2 || card.classList.contains('matched')) return;
                card.textContent = card.dataset.name;
                flippedCards.push(card);
                if (flippedCards.length === 2) {
                    lock = true;
                    setTimeout(checkMatch, 1000);
                }
            }

            function checkMatch() {
                const [card1, card2] = flippedCards;
                if (card1.dataset.name === card2.dataset.name) {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedCards.push(card1, card2);
                    userData.stars += 1;
                    updateStarCounter();
                } else {
                    setTimeout(() => {
                        card1.textContent = '❓';
                        card2.textContent = '❓';
                    }, 500);
                }
                flippedCards = [];
                lock = false;
                if (matchedCards.length === memoryCards.length) {
                    userData.progress += 1;
                    updateProgress();
                    alert('Memory Game Complete! +1 Progress!');
                    showSection('welcome');
                }
            }

            function initWudhuChallenge() {
                const container = document.getElementById('Level-3');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Wudhu Challenge 💧</h2>
                    <div class="wudhu-container">
                        <div class="wudhu-dropzone" id="obligatory-dropzone"><h3>Obligatory</h3></div>
                    </div>
                    <div id="wudhu-source" class="grid grid-cols-4 gap-2 mt-4"></div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
                const source = document.getElementById('wudhu-source');
                wudhuSteps.forEach(step => {
                    const stepElement = document.createElement('div');
                    stepElement.className = 'wudhu-step';
                    stepElement.draggable = true;
                    stepElement.dataset.id = step.id;
                    stepElement.textContent = step.name;
                    stepElement.addEventListener('dragstart', dragStartWudhu);
                    source.appendChild(stepElement);
                });
                document.getElementById('obligatory-dropzone').addEventListener('dragover', dragOverWudhu);
                document.getElementById('obligatory-dropzone').addEventListener('drop', dropWudhu);
            }

            let draggedWudhu;
            function dragStartWudhu(event) {
                draggedWudhu = event.target;
                event.dataTransfer.setData('text/plain', draggedWudhu.textContent);
                event.dataTransfer.setData('id', draggedWudhu.dataset.id);
            }

            function dragOverWudhu(event) { event.preventDefault(); }
            function dropWudhu(event) {
                event.preventDefault();
                const dropzone = document.getElementById('obligatory-dropzone');
                if (draggedWudhu) {
                    const step = draggedWudhu.cloneNode(true);
                    step.draggable = true;
                    dropzone.appendChild(step);
                    draggedWudhu.remove();
                    draggedWudhu = null;
                    checkWudhuOrder();
                }
            }

            function checkWudhuOrder() {
                const steps = Array.from(document.querySelectorAll('#obligatory-dropzone .wudhu-step'));
                const correct = steps.every((step, index) => {
                    const stepData = wudhuSteps.find(s => s.id == step.dataset.id);
                    return stepData && stepData.order === index + 1;
                });
                if (correct && steps.length === wudhuSteps.length) {
                    userData.progress += 1;
                    updateProgress();
                    alert('Wudhu Challenge Complete! +1 Progress!');
                    showSection('welcome');
                }
            }

            function showKarbala() {
                const container = document.getElementById('Level-4');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Karbala Epic 🏰</h2>
                    <p>The Battle of Karbala occurred in 61 AH (680 CE) in present-day Iraq. Imam Hussain (as) stood against tyranny.</p>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
            }

            function initArtZone() {
                const container = document.getElementById('Level-5');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Art Quest 🎨</h2>
                    <canvas id="art-canvas" width="600" height="400"></canvas>
                    <button class="btn mt-4" onclick="saveArtwork()">Save Artwork</button>
                    <button class="btn mt-2" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
                const canvas = document.getElementById('art-canvas');
                const ctx = canvas.getContext('2d');
                let drawing = false;
                canvas.addEventListener('mousedown', () => drawing = true);
                canvas.addEventListener('mouseup', () => drawing = false);
                canvas.addEventListener('mousemove', (e) => {
                    if (drawing) {
                        ctx.fillStyle = '#000';
                        ctx.beginPath();
                        ctx.arc(e.offsetX, e.offsetY, 5, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                window.saveArtwork = () => {
                    const dataURL = canvas.toDataURL();
                    userData.artwork = dataURL;
                    saveUserData();
                    alert('Artwork saved!');
                };
            }

            function showHajj() {
                const container = document.getElementById('Level-6');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Explore Hajj 🌍</h2>
                    <p>Hajj is the annual Islamic pilgrimage to Mecca, a mandatory religious duty for Muslims who are physically and financially able.</p>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
            }

            function startStory() {
                userData.storyPath = [];
                showStoryScene('mecca.start');
            }

            function showStoryScene(sceneId) {
                const [story, scene] = sceneId.split('.');
                const fullScene = storyData[story][scene];
                userData.storyPath.push({ id: sceneId, choice: null });
                const container = document.getElementById('Level-7');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Choose Your Path 📖</h2>
                    <div class="story-card"><p>${fullScene.text}</p>${Object.entries(fullScene.choices).map(([key, choice]) => `<button class="btn mt-2" onclick="makeChoice('${story}', '${scene}', '${key}', '${choice.next}')">${choice.text}</button>`).join('')}</div>
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>
                    <div id="story-animation" class="lottie-animation"></div>`;
                document.getElementById('story-background').style.backgroundImage = `url(${fullScene.background})`;
                loadAnimation(fullScene.animation);
            }

            function makeChoice(story, scene, choiceKey, nextScene) {
                const fullScene = storyData[story][scene];
                userData.storyPath[userData.storyPath.length - 1].choice = choiceKey;
                showStoryScene(`${story}.${nextScene}`);
            }

            function loadAnimation(type) {
                const animationContainer = document.getElementById('story-animation');
                if (animationContainer) {
                    let animationPath;
                    switch (type) {
                        case 'happy': animationPath = 'https://assets10.lottiefiles.com/packages/lf20_5d6w4w8k.json'; break;
                        case 'sad': animationPath = 'https://assets10.lottiefiles.com/packages/lf20_6l1q5q8t.json'; break;
                        default: animationPath = 'https://assets10.lottiefiles.com/packages/lf20_5d6w4w8k.json';
                    }
                    lottie.loadAnimation({
                        container: animationContainer,
                        renderer: 'svg',
                        loop: true,
                        autoplay: true,
                        path: animationPath
                    }).catch(() => console.log('Animation failed to load'));
                }
            }

            function showMissions() {
                const container = document.getElementById('missions');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Mission Board ⭐</h2>
                    ${missions.map(m => `
                        <div class="story-card">
                            <h3>${m.title}</h3>
                            <p>${m.question}</p>
                            <input id="mission-input-${m.id}" class="border rounded-lg p-2">
                            <button class="btn mt-2" onclick="checkMission('${m.id}', '${m.answer}')">Submit</button>
                        </div>
                    `).join('')}
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
            }

            function checkMission(id, answer) {
                const userAnswer = document.getElementById(`mission-input-${id}`).value.toLowerCase();
                if (userAnswer === answer.toLowerCase()) {
                    userData.stars += 2;
                    userData.missions[id] = true;
                    updateStarCounter();
                    alert('Mission Complete! +2 Stars! 🎉');
                } else alert('Wrong! Try again! 😕');
            }

            function showProfile() {
                const container = document.getElementById('profile');
                container.innerHTML = `
                    <h2 class="text-3xl text-orange-600 mb-4">Profile 🏡</h2>
                    <p>Email: ${userData.email || 'Not set'}</p>
                    <p>Name: ${userData.name || 'Young Explorer'}</p>
                    <p>Stars: <span id="profile-star-count">${userData.stars}</span> ⭐</p>
                    <img src="${userData.character || 'https://via.placeholder.com/100'}" alt="Avatar" class="w-24 h-24 mx-auto">
                    <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
                    <button class="btn mt-2" onclick="logout()">Logout 🚪</button>`;
            }

            function updateStarCounter() {
                document.getElementById('star-count').textContent = userData.stars + ' ⭐';
                if (document.getElementById('profile-star-count')) document.getElementById('profile-star-count').textContent = userData.stars;
                saveUserData();
            }

            function updateProgress() {
                const progress = document.getElementById('progress');
                if (progress) progress.style.width = `${(userData.progress / 10) * 100}%`;
            }

            function updateBadges() {
                const badgeElement = document.querySelector('.badge');
                if (badgeElement) badgeElement.textContent = `🏅 Badge: ${userData.badges[userData.badges.length - 1] || 'Explorer'}`;
                saveUserData();
            }
        });
    </script>
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            margin: 0;
            padding: 0;
            background: #87CEEB;
            position: relative;
            z-index: 0;
        }
        #hero {
            height: 100vh;
            padding-top: 10rem;
            text-align: center;
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0 0 30px 30px;
        }
        .section {
            min-height: 100vh;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            margin: 1rem;
        }
        .btn {
            background: #FFA500;
            color: #fff;
            padding: 1rem 2rem;
            border-radius: 20px;
            font-size: 1.2rem;
            margin: 0.5rem;
            z-index: 30;
            position: relative;
        }
        .btn:hover {
            background: #32CD32;
            transform: scale(1.05);
        }
        .card-grid {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            padding: 2rem;
            z-index: 20;
        }
        .card {
            background: #FF69B4;
            padding: 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            width: 200px;
            z-index: 20;
        }
        .card:hover {
            transform: scale(1.05);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            z-index: 201;
        }
        .story-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 1rem;
            margin: 1rem 0;
            z-index: 20;
        }
        .memory-card {
            width: 100px;
            height: 100px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 10px;
            z-index: 20;
        }
        .memory-card.matched {
            background: #32CD32;
            color: #fff;
        }
        .wudhu-step {
            width: 100px;
            height: 100px;
            background: #87CEEB;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: move;
            border-radius: 10px;
            z-index: 20;
        }
        .wudhu-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }
        .wudhu-dropzone {
            min-height: 120px;
            background: #fff;
            border: 2px dashed #FFA500;
            border-radius: 10px;
            padding: 1rem;
            z-index: 20;
        }
        #art-canvas {
            border: 2px solid #FFA500;
            border-radius: 10px;
            z-index: 20;
        }
        .character {
            border: 2px solid #FFA500;
            border-radius: 10px;
            cursor: pointer;
            z-index: 20;
        }
        .character.selected {
            border-color: #32CD32;
        }
        .lottie-animation {
            width: 200px;
            height: 200px;
            margin: 1rem auto;
            z-index: 20;
        }
        .progress-bar {
            width: 80%;
            height: 20px;
            background: #fff;
            border-radius: 10px;
            margin: 1rem auto;
            z-index: 20;
        }
        .progress {
            height: 100%;
            background: #FFA500;
            border-radius: 10px;
            transition: width 0.5s;
        }
        #story-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            transition: background-image 1s;
        }
        .star-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            color: #FFD700;
            z-index: 30;
        }
        .avatar-display {
            position: fixed;
            bottom: 10px;
            left: 10px;
            width: 100px;
            height: 100px;
            z-index: 30;
        }
        .tree {
            position: absolute;
            width: 100px;
            height: 150px;
            background: green;
            border-radius: 50% 50% 0 0;
            z-index: 1;
            animation: grow 3s infinite;
        }
        @keyframes grow {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .cloud {
            position: absolute;
            width: 150px;
            height: 80px;
            background: white;
            border-radius: 50px;
            z-index: 1;
            animation: float 6s infinite;
        }
        @keyframes float {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        .star {
            position: absolute;
            width: 20px;
            height: 20px;
            background: yellow;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            z-index: 1;
            animation: twinkle 2s infinite;
        }
        @keyframes twinkle {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        .moon {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #FFD700;
            border-radius: 50%;
            z-index: 1;
            animation: glow 4s infinite;
        }
        @keyframes glow {
            0% { box-shadow: 0 0 10px #FFD700; }
            50% { box-shadow: 0 0 20px #FFD700; }
            100% { box-shadow: 0 0 10px #FFD700; }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="landing-page" class="hero">
        <h1 class="text-3xl mb-4">Shia Islamic Adventure Quest 🌙</h1>
        <button class="btn" onclick="showLoginModal()">Login 🚪</button>
        <button class="btn" onclick="showSignupModal()">Sign Up ✨</button>
        <button class="btn" onclick="showAdminLoginModal()">Admin Login 🔑</button>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl text-orange-600 mb-2">Login</h2>
            <input type="email" id="login-email" placeholder="Enter your email" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <input type="password" id="login-password" placeholder="Enter password" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <p class="text-right mb-2"><a href="#" onclick="document.getElementById('reset-password-modal').style.display='flex'; console.log('Reset password modal shown');">Forgot Password?</a></p>
            <button class="btn" onclick="login(); console.log('Login attempted');">Login</button>
            <button class="btn mt-2" onclick="closeModal(event)">Cancel</button>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="reset-password-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl text-orange-600 mb-2">Reset Password</h2>
            <input type="email" id="reset-email" placeholder="Enter your email" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <button class="btn" onclick="resetPassword(); console.log('Password reset requested');">Send Reset Email</button>
            <button class="btn mt-2" onclick="closeModal(event)">Cancel</button>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signup-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl text-orange-600 mb-2">Sign Up</h2>
            <input type="text" id="signup-name" placeholder="Enter your name" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <input type="email" id="signup-email" placeholder="Enter your email" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <input type="password" id="signup-password" placeholder="Enter password" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <div id="gender-select" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
                <label><input type="radio" name="gender" value="boy" checked> Boy</label>
                <label><input type="radio" name="gender" value="girl"> Girl</label>
            </div>
            <select id="year-select" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
                <option value="Level-1">Level 1</option>
                <option value="Level-2">Level 2</option>
                <option value="Level-3">Level 3</option>
                <option value="Level-4">Level 4</option>
                <option value="Level-5">Level 5</option>
                <option value="Level-6">Level 6</option>
                <option value="Level-7">Level 7</option>
                <option value="Level-8">Level 8</option>
                <option value="Level-9">Level 9</option>
                <option value="Level-10">Level 10</option>
            </select>
            <div class="flex justify-center gap-2 mb-2">
                <img src="https://yourusername.github.io/your-repo/images/boy1.png" alt="Boy 1" class="character w-16 h-16 cursor-pointer">
                <img src="https://yourusername.github.io/your-repo/images/boy2.png" alt="Boy 2" class="character w-16 h-16 cursor-pointer">
                <img src="https://yourusername.github.io/your-repo/images/girl1.png" alt="Girl 1" class="character w-16 h-16 cursor-pointer">
                <img src="https://yourusername.github.io/your-repo/images/girl2.png" alt="Girl 2" class="character w-16 h-16 cursor-pointer">
            </div>
            <button id="signup-btn" class="btn" onclick="signupUser(); console.log('Sign up submitted');">Sign Up</button>
            <button class="btn mt-2" onclick="closeModal(event)">Cancel</button>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl text-orange-600 mb-2">Admin Login</h2>
            <input type="text" id="admin-username" placeholder="Username" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <input type="password" id="admin-password" placeholder="Password" class="border-2 border-orange-500 rounded-lg p-2 w-full text-black mb-2">
            <button class="btn" onclick="loginAdmin(); console.log('Admin login attempted');">Login</button>
            <button class="btn mt-2" onclick="closeModal(event)">Cancel</button>
        </div>
    </div>

    <!-- Welcome Section -->
    <div id="welcome" class="section hidden">
        <div class="content">
            <h2 class="text-3xl text-orange-600 mb-4">Welcome, <span id="welcome-name">${userData.name || 'Young Explorer'}</span>! 🌟</h2>
            <div class="card-grid">
                <div class="card" onclick="showSection('Level-1')">
                    <h3>Quiz Challenge 📖</h3>
                    <p>Test your Islamic knowledge!</p>
                </div>
                <div class="card" onclick="showSection('Level-2')">
                    <h3>Memory Quest 🧠</h3>
                    <p>Match the Imams!</p>
                </div>
                <div class="card" onclick="showSection('Level-3')">
                    <h3>Wudhu Challenge 💧</h3>
                    <p>Order the steps!</p>
                </div>
                <div class="card" onclick="showSection('Level-4')">
                    <h3>Karbala Epic 🏰</h3>
                    <p>Learn about Karbala!</p>
                </div>
                <div class="card" onclick="showSection('Level-5')">
                    <h3>Art Quest 🎨</h3>
                    <p>Create Islamic art!</p>
                </div>
                <div class="card" onclick="showSection('Level-6')">
                    <h3>Explore Hajj 🌍</h3>
                    <p>Learn about the pilgrimage!</p>
                </div>
                <div class="card" onclick="showSection('Level-7')">
                    <h3>Choose Your Path 📖</h3>
                    <p>Live an Islamic story!</p>
                </div>
                <div class="card" onclick="showSection('missions')">
                    <h3>Mission Board ⭐</h3>
                    <p>Complete daily tasks!</p>
                </div>
            </div>
            <button class="btn mt-4" onclick="showSection('profile')">View Profile 🏡</button>
            <button class="btn mt-2" onclick="logout()">Logout 🚪</button>
        </div>
    </div>

    <!-- Level 1 Section -->
    <div id="Level-1" class="section hidden"></div>

    <!-- Level 2 Section -->
    <div id="Level-2" class="section hidden"></div>

    <!-- Level 3 Section -->
    <div id="Level-3" class="section hidden"></div>

    <!-- Level 4 Section -->
    <div id="Level-4" class="section hidden"></div>

    <!-- Level 5 Section -->
    <div id="Level-5" class="section hidden"></div>

    <!-- Level 6 Section -->
    <div id="Level-6" class="section hidden"></div>

    <!-- Level 7 Section -->
    <div id="Level-7" class="section hidden"></div>

    <!-- Level 8 Section -->
    <div id="Level-8" class="section hidden">
        <h2 class="text-3xl text-orange-600 mb-4">Level 8 Challenge</h2>
        <p>Content for Level 8 goes here.</p>
        <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
        <button class="btn mt-2" onclick="logout()">Logout 🚪</button>
    </div>

    <!-- Level 9 Section -->
    <div id="Level-9" class="section hidden">
        <h2 class="text-3xl text-orange-600 mb-4">Level 9 Challenge</h2>
        <p>Content for Level 9 goes here.</p>
        <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
        <button class="btn mt-2" onclick="logout()">Logout 🚪</button>
    </div>

    <!-- Level 10 Section -->
    <div id="Level-10" class="section hidden">
        <h2 class="text-3xl text-orange-600 mb-4">Level 10 Challenge</h2>
        <p>Content for Level 10 goes here.</p>
        <button class="btn mt-4" onclick="showSection('welcome')">Back to Home 🏡</button>
        <button class="btn mt-2" onclick="logout()">Logout 🚪</button>
    </div>

    <!-- Missions Section -->
    <div id="missions" class="section hidden"></div>

    <!-- Profile Section -->
    <div id="profile" class="section hidden"></div>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div id="progress" class="progress" style="width: 0%;"></div>
    </div>

    <div class="star-counter" id="star-count">0 ⭐</div>
    <img src="https://yourusername.github.io/your-repo/images/mascot.png" alt="Avatar" class="avatar-display" id="avatar-display" style="display: none;">
    <div id="story-background"></div>

    <!-- Dynamic Elements -->
    <div class="tree" style="left: 10%; top: 60%; animation-delay: 0s;"></div>
    <div class="tree" style="left: 80%; top: 70%; animation-delay: 2s;"></div>
    <div class="cloud" style="left: 20%; top: 20%; animation-delay: 1s;"></div>
    <div class="cloud" style="left: 70%; top: 30%; animation-delay: 3s;"></div>
    <div class="star" style="left: 30%; top: 15%; animation-delay: 0.5s;"></div>
    <div class="star" style="left: 50%; top: 10%; animation-delay: 1.5s;"></div>
    <div class="moon"></div>
</body>
</html>