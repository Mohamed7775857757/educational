<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shia Islamic Adventure Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            background: none;
            overflow: hidden;
        }
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #87CEEB url('https://yourusername.github.io/your-repo/images/background.jpg') no-repeat center center fixed;
            background-size: cover;
            z-index: -1;
        }
        .ui-container {
            position: relative;
            z-index: 1;
        }
        .header-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(90deg, #FFA500, #FF4500);
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-bar h1 {
            color: #fff;
            font-size: 1.8rem;
            text-shadow: 2px 2px #000;
            animation: bounce 1s ease-out infinite;
        }
        .tree, .cloud, .star, .moon {
            position: absolute;
            animation: float 6s infinite ease-in-out;
            z-index: 1;
        }
        .tree { content: 'üå≥'; font-size: 80px; }
        .cloud { content: '‚òÅÔ∏è'; font-size: 50px; animation: float 8s infinite ease-in-out; }
        .star { content: '‚≠ê'; font-size: 30px; animation: twinkle 2s infinite alternate; }
        .moon { content: 'üåô'; font-size: 60px; animation: shine 4s infinite ease-in-out; top: 10%; left: 10%; }
        .hero {
            height: 100vh;
            position: relative;
            overflow: hidden;
            color: #fff;
            text-align: center;
            padding-top: 10rem;
            border-radius: 0 0 50px 50px;
            display: block;
            z-index: 10;
            background: none;
        }
        .hero h1 {
            font-size: 3.5rem;
            animation: bounce 1s ease-out;
        }
        .hero p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            animation: fadeIn 1.5s ease-out;
        }
        .hero .btn {
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            color: #fff;
            padding: 2rem 4rem;
            font-size: 2rem;
            border-radius: 30px;
            transition: transform 0.3s, background 0.3s;
            text-shadow: 1px 1px #000;
            z-index: 10;
            position: relative;
            cursor: pointer;
        }
        .hero .btn:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #32CD32, #87CEEB);
            box-shadow: 0 0 10px #32CD32;
        }
        .section {
            min-height: 100vh;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding-top: 80px;
            background: none;
        }
        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            color: #000;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8));
            border-radius: 20px;
            z-index: 1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .card-grid {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            padding: 4rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 20;
            flex-wrap: wrap;
        }
        .card {
            background: linear-gradient(135deg, #FF69B4, #FFA500);
            border-radius: 30px;
            padding: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            text-align: center;
            overflow: hidden;
            width: 250px;
            z-index: 20;
        }
        .card:hover {
            transform: translateY(-15px);
            box-shadow: 0 15px 40px rgba(50, 205, 50, 0.3);
        }
        .card h3 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px #000;
        }
        .card p {
            color: #fff;
            text-shadow: 1px 1px #000;
        }
        .card:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
            z-index: -1;
        }
        .btn {
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            color: #fff;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            border-radius: 20px;
            font-weight: 600;
            transition: transform 0.3s, background 0.3s;
            text-shadow: 1px 1px #000;
            z-index: 10;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }
        .btn:hover {
            transform: scale(1.1);
            background: linear-gradient(90deg, #32CD32, #87CEEB);
            box-shadow: 0 6px 15px rgba(50, 205, 50, 0.5);
        }
        .btn:active {
            transform: scale(0.95);
        }
        .star-counter {
            position: fixed;
            top: 70px;
            right: 1rem;
            background: #fff;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            color: #FFA500;
            z-index: 50;
            animation: pulse 2s infinite;
        }
        .avatar-display {
            position: fixed;
            top: 6rem;
            left: 1rem;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid #FFA500;
            object-fit: cover;
            animation: float 3s infinite ease-in-out;
            z-index: 50;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 201;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
            z-index: 20;
        }
        #progress {
            height: 100%;
            background: linear-gradient(90deg, #FFA500, #FF69B4);
            width: 0%;
            transition: width 0.5s ease-in-out;
            border-radius: 10px;
        }
        .badge {
            background: #FFD700;
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            margin: 0.5rem;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 20;
        }
        .story-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8));
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem auto;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: left;
            z-index: 20;
        }
        .placeholder-images {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding: 10px 0;
        }
        .placeholder-image {
            width: 400px;
            height: 300px;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .memory-card {
            width: 100px;
            height: 100px;
            background: #FFA500;
            margin: 10px;
            display: inline-block;
            cursor: pointer;
            border-radius: 10px;
            text-align: center;
            line-height: 100px;
            font-size: 14px;
            color: #fff;
            transition: transform 0.3s;
        }
        .memory-card.flipped {
            background: #90EE90;
            transform: rotateY(180deg);
        }
        .hidden {
            display: none;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        @keyframes twinkle {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        @keyframes shine {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            .card {
                width: 120px;
                padding: 0.5rem;
            }
            .hero h1 {
                font-size: 2.5rem;
            }
            .hero .btn {
                padding: 1rem 2rem;
                font-size: 1.5rem;
            }
            .section {
                padding: 2rem 1rem;
            }
            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
            .placeholder-images {
                flex-direction: column;
                gap: 10px;
            }
            .placeholder-image {
                width: 100%;
                height: 200px;
            }
            .memory-card {
                width: 70px;
                height: 70px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="background-layer"></div>
    <div class="ui-container">
        <div class="header-bar">
            <h1>Shia Islamic Adventure Quest</h1>
        </div>
        <div class="star-counter" id="star-count">0 ‚≠ê</div>
        <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/boy1.jpg" alt="Avatar" class="avatar-display" id="avatar-display" style="display: none;">
        <div class="tree" style="top: 20%; left: 5%;"></div>
        <div class="cloud" style="top: 10%; right: 10%;"></div>
        <div class="star" style="top: 15%; left: 20%;"></div>
        <div class="moon" style="top: 10%; left: 10%;"></div>
        <div class="hero" id="hero">
            <h1>Welcome to Your Adventure!</h1>
            <p>Explore, learn, and grow with Shia Islamic teachings.</p>
            <button class="btn" onclick="showLoginModal()">Login üö™</button>
            <button class="btn" onclick="showSignupModal()">Sign Up ‚ú®</button>
            <div class="placeholder-images">
                <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/makkah.jpg" alt="Makkah" class="placeholder-image">
                <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/madinah.jpg" alt="Madinah" class="placeholder-image">
                <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/najaf.jpg" alt="Najaf" class="placeholder-image">
                <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/karbala.jpg" alt="Karbala" class="placeholder-image">
            </div>
        </div>
        <div id="landing-page" class="hidden">
            <div class="card-grid">
                <div class="card" onclick="showSection('missions')">
                    <h3>Missions</h3>
                    <p>Daily Tasks ‚≠ê</p>
                </div>
                <div class="card" onclick="showSection('memory-game')">
                    <h3>Memory Game</h3>
                    <p>Match the Imams ‚≠ê</p>
                </div>
                <div class="card" onclick="showSection('profile')">
                    <h3>Profile</h3>
                    <p>Your Journey üè°</p>
                </div>
            </div>
            <button class="btn mt-4" onclick="showAdminLoginModal()">Admin Login üîê</button>
        </div>
        <div id="welcome" class="section hidden">
            <div class="content">
                <h2 class="text-3xl text-orange-600 mb-4">Welcome, <span id="welcome-name">Young Explorer</span>! üåü</h2>
                <div class="progress-bar">
                    <div id="progress"></div>
                </div>
                <p class="badge"></p>
                <div class="card-grid">
                    <div class="card" onclick="showSection('missions')">
                        <h3>Missions</h3>
                        <p>Daily Tasks ‚≠ê</p>
                    </div>
                    <div class="card" onclick="showSection('memory-game')">
                        <h3>Memory Game</h3>
                        <p>Match the Imams ‚≠ê</p>
                    </div>
                    <div class="card" onclick="showSection('profile')">
                        <h3>Profile</h3>
                        <p>Your Journey üè°</p>
                    </div>
                </div>
                <button class="btn mt-4" onclick="showAdminLoginModal()">Admin Login üîê</button>
                <button class="btn mt-4" onclick="logout()">Logout üö™</button>
            </div>
        </div>
        <div id="missions" class="section hidden">
            <div class="content">
                <h2 class="text-3xl text-orange-600 mb-4">Mission Board ‚≠ê</h2>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Daily Salah</h3>
                    <p>How many daily prayers?</p>
                    <input id="mission-salah-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                    <button class="btn mt-2" onclick="checkMission('salah', '5')">Submit üéâ</button>
                </div>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Learn Dua</h3>
                    <p>Dua before eating?</p>
                    <input id="mission-dua-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                    <button class="btn mt-2" onclick="checkMission('dua', 'Bismillah')">Submit üéâ</button>
                </div>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>
            </div>
        </div>
        <div id="memory-game" class="section hidden">
            <div class="content">
                <h2 class="text-3xl text-orange-600 mb-4">Memory Game ‚≠ê</h2>
                <div id="memory-board" class="card-grid"></div>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>
            </div>
        </div>
        <div id="profile" class="section hidden"></div>
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <h2>Login üö™</h2>
                <input id="login-email" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Email" type="email">
                <input id="login-password" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Password" type="password">
                <button class="btn mt-4" onclick="login()">Login üéâ</button>
                <button class="btn mt-2" onclick="showResetPasswordModal()">Forgot Password? üîë</button>
                <button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
            </div>
        </div>
        <div id="signup-modal" class="modal">
            <div class="modal-content">
                <h2>Sign Up ‚ú®</h2>
                <input id="signup-name" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Name">
                <div class="mt-2">
                    <label><input type="radio" name="gender" value="boy" checked onchange="filterAvatars()"> Boy üë¶</label>
                    <label class="ml-4"><input type="radio" name="gender" value="girl" onchange="filterAvatars()"> Girl üëß</label>
                </div>
                <select id="year-select" class="border rounded-lg p-2 bg-white text-black mt-2 w-full">
                    <option value="Level-1">Level 1</option>
                    <option value="Level-2">Level 2</option>
                    <option value="Level-3">Level 3</option>
                    <option value="Level-4">Level 4</option>
                    <option value="Level-5">Level 5</option>
                    <option value="Level-6">Level 6</option>
                    <option value="Level-7">Level 7</option>
                </select>
                <div id="character-select" class="character-select mt-2">
                    <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/boy1.jpg" alt="Boy 1" class="character w-16 h-16 mr-2">
                    <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/boy2.jpg" alt="Boy 2" class="character w-16 h-16 mr-2">
                    <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/girl1.jpg" alt="Girl 1" class="character w-16 h-16 mr-2" style="display: none;">
                    <img src="https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/girl2.jpg" alt="Girl 2" class="character w-16 h-16" style="display: none;">
                </div>
                <input id="signup-email" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Email" type="email">
                <input id="signup-password" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Password" type="password">
                <button class="btn mt-4" onclick="signupUser()">Sign Up üéâ</button>
                <button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
            </div>
        </div>
        <div id="admin-login-modal" class="modal">
            <div class="modal-content">
                <h2>Admin Login üîê</h2>
                <input id="admin-username" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Email" type="email">
                <input id="admin-password" class="border rounded-lg p-2 bg-white text-black mt-2 w-full" placeholder="Password" type="password">
                <button class="btn mt-4" onclick="loginAdmin()">Login üéâ</button>
                <button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
            </div>
        </div>
        <div id="reset-password-modal" class="modal">
            <div class="modal-content">
                <h2>Reset Password üîë</h2>
                <input id="reset-email" class="border rounded-lg p-2 bg-white text-black mt-4 w-full" placeholder="Email" type="email">
                <button class="btn mt-4" onclick="resetPassword()">Send Reset Email üìß</button>
                <button class="btn mt-2" onclick="closeModal(event)">Close ‚ùå</button>
            </div>
        </div>
    </div>
    <!-- Firebase SDK Script (non-module compatible) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase.js"></script>
    <script>
        console.log('Script loading started...');

        // Global variables
        let userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
        let flippedCards = [];
        let matchedPairs = 0;

        // Firebase initialization
        const firebaseConfig = {
            apiKey: "AIzaSyBD2asTEG40b4hhVmUZKlGd3ZPe-NJctxM",
            authDomain: "shia-kids-learning-tool.firebaseapp.com",
            projectId: "shia-kids-learning-tool",
            storageBucket: "shia-kids-learning-tool.appspot.com",
            messagingSenderId: "786313108719",
            appId: "1:786313108719:web:5d4d9ced7abd14b9d18f1a"
        };

        let app, auth;
        try {
            if (typeof firebase !== 'undefined' && firebase.initializeApp) {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                console.log('Firebase initialized successfully');
            } else {
                console.error('Firebase library not loaded');
                alert('Firebase library failed to load. Please check your internet connection or contact support.');
            }
        } catch (error) {
            console.error('Firebase initialization error:', error.message);
            alert('Firebase initialization failed: ' + error.message);
        }

        // UI Functions
        window.showLoginModal = function() {
            console.log('Attempting to show login modal...');
            const modal = document.getElementById('login-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Login modal displayed');
            } else {
                console.error('Login modal element not found');
            }
        };

        window.showSignupModal = function() {
            console.log('Attempting to show signup modal...');
            const modal = document.getElementById('signup-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Signup modal displayed');
            } else {
                console.error('Signup modal element not found');
            }
        };

        window.showAdminLoginModal = function() {
            console.log('Attempting to show admin login modal...');
            const modal = document.getElementById('admin-login-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Admin login modal displayed');
            } else {
                console.error('Admin login modal element not found');
            }
        };

        window.showSection = function(sectionId) {
            document.querySelectorAll('.section, #landing-page, #hero').forEach(el => el.classList.add('hidden'));
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                gsap.from(`#${sectionId.replace(/ /g, '-')}`, { opacity: 0, y: 50, duration: 0.5, ease: 'power2.out' });
                if (sectionId === 'missions') showMissions();
                if (sectionId === 'memory-game') initializeMemoryGame();
                if (sectionId === 'profile' && userData.email) showProfile();
                updateProgress();
                updateBadges();
            }
        };

        window.signupUser = function() {
            userData.name = document.getElementById('signup-name').value || 'Young Explorer';
            userData.gender = document.querySelector('input[name="gender"]:checked').value;
            userData.year = document.getElementById('year-select').value;
            const selected = document.querySelector('.character.selected');
            userData.character = selected ? selected.src : (userData.gender === 'boy' ? 'https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/boy1.jpg' : 'https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/girl1.jpg');
            saveUserData();

            if (auth) {
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        alert("‚úÖ Sign-up successful!");
                        userData.email = email;
                        closeModal({ target: { className: 'modal' } });
                        loadUserData();
                        showSection('welcome');
                    })
                    .catch(error => alert("‚ùå " + error.message));
            } else {
                alert("‚ùå Firebase authentication not initialized. Please check your internet connection or contact support.");
            }
        };

        window.login = function() {
            if (auth) {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        alert("‚úÖ Login successful!");
                        userData.email = email;
                        loadUserData();
                    })
                    .catch(error => alert("‚ùå " + error.message));
            } else {
                alert("‚ùå Firebase authentication not initialized. Please check your internet connection or contact support.");
            }
        };

        window.resetPassword = function() {
            if (auth) {
                const email = document.getElementById('reset-email').value;
                auth.sendPasswordResetEmail(email)
                    .then(() => alert("üìß Password reset email sent!"))
                    .catch(error => alert("‚ùå " + error.message));
            } else {
                alert("‚ùå Firebase authentication not initialized. Please check your internet connection or contact support.");
            }
        };

        window.logout = function() {
            if (auth) {
                auth.signOut().then(() => {
                    alert("‚úÖ Logged out successfully!");
                    userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
                    localStorage.removeItem('userData');
                    document.getElementById('landing-page').classList.add('hidden');
                    document.getElementById('welcome').classList.add('hidden');
                    document.getElementById('profile').classList.add('hidden');
                    document.getElementById('avatar-display').style.display = 'none';
                    document.getElementById('star-count').textContent = '0 ‚≠ê';
                    ['missions', 'memory-game'].forEach(id => {
                        const section = document.getElementById(id);
                        if (section) section.classList.add('hidden');
                    });
                    document.getElementById('hero').classList.remove('hidden');
                }).catch(error => alert("‚ùå " + error.message));
            } else {
                alert("‚ùå Firebase authentication not initialized. Please check your internet connection or contact support.");
            }
        };

        window.loginAdmin = function() {
            const email = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const adminEmail = 'melzein1987@gmail.com';
            const adminPassword = 'admin123';
            if (email === adminEmail && password === adminPassword) {
                alert('Admin login successful!');
                closeModal({ target: { className: 'modal' } });
            } else {
                alert('Invalid admin credentials!');
            }
        };

        window.closeModal = function(event) {
            if (event.target.classList.contains('modal') || event.target.classList.contains('btn')) {
                const modalId = event.target.closest('.modal')?.id;
                if (modalId) document.getElementById(modalId).style.display = 'none';
                document.getElementById('hero').classList.remove('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
                console.log('Modal closed via backdrop or button');
            }
        };

        function showMissions() {
            const container = document.getElementById('missions');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Mission Board ‚≠ê</h2>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Daily Salah</h3>
                    <p>How many daily prayers?</p>
                    <input id="mission-salah-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                    <button class="btn mt-2" onclick="checkMission('salah', '5')">Submit üéâ</button>
                </div>
                <div class="story-card mb-4">
                    <h3 class="text-xl">Learn Dua</h3>
                    <p>Dua before eating?</p>
                    <input id="mission-dua-input" class="border rounded-lg p-2 bg-white text-black mt-2" placeholder="Type your answer">
                    <button class="btn mt-2" onclick="checkMission('dua', 'Bismillah')">Submit üéâ</button>
                </div>
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>`;
            container.appendChild(content);
        }

        function checkMission(id, answer) {
            const userAnswer = document.getElementById(`mission-${id}-input`).value.toLowerCase();
            if (userAnswer === answer.toLowerCase()) {
                userData.stars += 2;
                userData.progress = Math.min(userData.progress + 1, 10);
                userData.missions[id] = true;
                updateStarCounter();
                updateProgress();
                confetti();
                const feedback = document.createElement('p');
                feedback.className = 'text-green-600 mt-2';
                feedback.textContent = 'Mission Complete! +2 Stars! üéâ';
                document.getElementById(`mission-${id}-input`).parentElement.appendChild(feedback);
            } else {
                const feedback = document.createElement('p');
                feedback.className = 'text-red-600 mt-2';
                feedback.textContent = 'Wrong! Try again! üòï';
                document.getElementById(`mission-${id}-input`).parentElement.appendChild(feedback);
            }
        }

        function showProfile() {
            if (!userData.email) {
                alert("Please log in to view your profile!");
                showSection('welcome');
                return;
            }
            const container = document.getElementById('profile');
            container.innerHTML = '';
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `<h2 class="text-3xl text-orange-600 mb-4">Profile üè°</h2>
                <p>Email: ${userData.email || 'Not set'}</p>
                <p>Name: ${userData.name}</p>
                <p>Level: ${userData.year}</p>
                <p>Stars: <span id="profile-star-count">${userData.stars}</span> ‚≠ê</p>
                <p>Progress: <span id="profile-progress">${userData.progress}/10</span></p>
                <p>Badges: ${userData.badges.join(', ')}</p>
                <img src="${userData.character || 'https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/boy1.jpg'}" alt="Avatar" class="w-32 h-32 rounded-full mx-auto mt-4">
                <button class="btn mt-4" onclick="showSection('welcome')">Back to Home üè°</button>
                <button class="btn mt-2" onclick="logout()">Logout üö™</button>`;
            container.appendChild(content);
            updateStarCounter();
            updateProgress();
        }

        function loadUserData() {
            const saved = localStorage.getItem('userData');
            if (saved) {
                userData = JSON.parse(saved);
                if (!userData.badges) userData.badges = ['Explorer'];
                document.getElementById('avatar-display').src = userData.character || 'https://raw.githubusercontent.com/Mohamed7775857757/educational/main/images/boy1.jpg';
                document.getElementById('avatar-display').style.display = 'block';
                document.getElementById('welcome-name').textContent = userData.name || 'Young Explorer';
                updateStarCounter();
                updateProgress();
                updateBadges();
                document.getElementById('landing-page').classList.add('hidden');
                document.getElementById('welcome').classList.remove('hidden');
                showSection('welcome');
            } else {
                document.getElementById('hero').classList.remove('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
            }
        }

        function saveUserData() {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function updateStarCounter() {
            document.getElementById('star-count').textContent = userData.stars;
            if (document.getElementById('profile-star-count')) document.getElementById('profile-star-count').textContent = userData.stars;
            saveUserData();
        }

        function updateProgress() {
            const progressElement = document.getElementById('progress');
            if (progressElement) {
                const progress = (userData.progress / 10) * 100;
                progressElement.style.width = `${progress}%`;
            }
            if (document.getElementById('profile-progress')) document.getElementById('profile-progress').textContent = `${userData.progress}/10`;
            saveUserData();
        }

        function updateBadges() {
            const badgeElement = document.querySelector('.badge');
            if (badgeElement) badgeElement.textContent = `üèÖ Badge: ${userData.badges[userData.badges.length - 1] || 'Explorer'}`;
            saveUserData();
        }

        function confetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function initializeMemoryGame() {
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            const individuals = [
                "Prophet Muhammad(s)", "Imam Ali(as)", "Sayeda Fatimah Al Zahraa(as)", "Imam Al Hasan(as)",
                "Imam Al Hussain(as)", "Imam Al Sajjad(as)", "Imam Al Baqir(as)", "Imam Al Sadiq(as)",
                "Imam Al Kathim(as)", "Imam Al Redha(as)", "Imam Al Jawad(as)", "Imam Al Hadi(as)",
                "Imam Al Askari(as)", "Imam Al Mahdi(as)"
            ];
            const cards = [...individuals, ...individuals]; // 28 cards (14 pairs)
            cards.sort(() => Math.random() - 0.5); // Shuffle

            cards.forEach((name, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.name = name;
                card.textContent = '?';
                card.addEventListener('click', () => {
                    if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
                        card.textContent = card.dataset.name;
                        card.classList.add('flipped');
                        flippedCards.push(card);
                        if (flippedCards.length === 2) {
                            setTimeout(checkMatch, 1000);
                        }
                    }
                });
                board.appendChild(card);
            });
            matchedPairs = 0;
            flippedCards = [];
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            if (card1.dataset.name === card2.dataset.name) {
                matchedPairs++;
                if (matchedPairs === 14) {
                    userData.stars += 5;
                    updateStarCounter();
                    alert('Congratulations! You matched all pairs! +5 Stars! üéâ');
                    confetti();
                }
            } else {
                card1.textContent = '?';
                card2.textContent = '?';
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }
            flippedCards = [];
        }

        function filterAvatars() {
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const characters = document.querySelectorAll('.character');
            characters.forEach(img => {
                const alt = img.alt;
                if (gender === 'boy' && (alt === 'Boy 1' || alt === 'Boy 2')) {
                    img.style.display = 'inline-block';
                } else if (gender === 'girl' && (alt === 'Girl 1' || alt === 'Girl 2')) {
                    img.style.display = 'inline-block';
                } else {
                    img.style.display = 'none';
                }
            });
            const selected = document.querySelector('.character.selected');
            if (selected && ((gender === 'boy' && !selected.alt.includes('Boy')) || (gender === 'girl' && !selected.alt.includes('Girl')))) {
                selected.classList.remove('selected');
                const defaultImg = gender === 'boy' ? document.querySelector('[alt="Boy 1"]') : document.querySelector('[alt="Girl 1"]');
                if (defaultImg) defaultImg.classList.add('selected');
                userData.character = defaultImg ? defaultImg.src : userData.character;
            }
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded, initializing app...');

            const hero = document.getElementById('hero');
            const welcomeSection = document.getElementById('welcome');
            const profileSection = document.getElementById('profile');
            if (hero) hero.classList.remove('hidden');
            if (welcomeSection) welcomeSection.classList.add('hidden');
            if (profileSection) profileSection.classList.add('hidden');

            ['login-modal', 'signup-modal', 'admin-login-modal', 'reset-password-modal'].forEach(id => {
                const modal = document.getElementById(id);
                if (modal) modal.style.display = 'none';
            });

            if (auth) {
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        userData.email = user.email;
                        loadUserData();
                        document.getElementById('login-modal').style.display = 'none';
                        document.getElementById('hero').classList.add('hidden');
                        document.getElementById('welcome').classList.remove('hidden');
                        showSection('welcome');
                    } else {
                        userData = { name: '', gender: 'boy', year: 'Level-1', character: '', stars: 0, progress: 0, badges: ['Explorer'], missions: {}, artwork: {}, storyPath: [] };
                        localStorage.removeItem('userData');
                        if (hero) hero.classList.remove('hidden');
                        if (welcomeSection) welcomeSection.classList.add('hidden');
                        if (profileSection) profileSection.classList.add('hidden');
                        ['login-modal', 'signup-modal', 'admin-login-modal', 'reset-password-modal'].forEach(id => {
                            const modal = document.getElementById(id);
                            if (modal) modal.style.display = 'none';
                        });
                    }
                });
            } else {
                console.error('Firebase authentication not initialized');
            }

            console.log('Functions defined:', {
                showLoginModal: typeof window.showLoginModal,
                showSignupModal: typeof window.showSignupModal
            });

            window.addEventListener('load', () => {
                console.log('Window fully loaded, verifying UI...');
                document.getElementById('hero').classList.remove('hidden');
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('profile').classList.add('hidden');
                filterAvatars();
                document.querySelectorAll('.character').forEach(img => {
                    img.addEventListener('click', () => {
                        document.querySelectorAll('.character').forEach(i => i.classList.remove('selected'));
                        img.classList.add('selected');
                        userData.character = img.src;
                        document.getElementById('avatar-display').src = userData.character;
                        saveUserData();
                    });
                });
            });
        });

        console.log('Script loading completed');
    </script>
</body>
</html>